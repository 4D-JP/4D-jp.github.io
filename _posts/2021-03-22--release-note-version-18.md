---
layout: fix
title: "4D v18 Hotfix 1 修正リスト"
date: 2021-03-22 08:00:00
categories: 修正リスト
tags: "18.4" hotfix
build: 263073
version: 18.4
---

**バージョン**: {{page.version}}  
**ビルド**: {{page.build}}  

* ACI0101699 `VP Convert from 4D view`で4D Viewスプレッドシートが正しく変換されないことがありました。新規スプレッドシートも罫線のない白紙のドキュメントになります。値のないセルがうまく処理されないようです。

* ACI0101580 View ProスプレッドシートをPDF形式でエクスポートした場合，標準体で出力されるべきセルのテキストがボールド体で出力されることがありました。

* ACI0101444 `VP Convert from 4D View`でドキュメントを変換しようとした場合，エラー`-10713`が返されることがありました。
 
* ACI0101698 プロジェクトモードのみ。ストラクチャのコメントにXML 1.0で許可されていない文字が使用されている場合，バイナリデータベースから変換したプロジェクトを開くことができませんでした。

**注記**: 修正により，制御文字はXML 1.0準拠の`&#hhhh;`フォーマットに変換されるようになりました。

* ACI0101708 ウィンドウの最大化を解除したときに振る舞いがv17以前のバージョンと違いました。ウィンドウを最大化した場合，フォームオブジェクトはプロパティに応じて移動またはリサイズされるので，結果的に元のウィンドウサイズに収まらないことがあります。v17の場合，最大化を解除したウィンドウは，そのようなオブジェクトが表示できる最小のサイズに調整されました。v18では，最大化前のサイズに戻るため，リサイズまたは移動したオブジェクトが描画領域の外に出てしまうことがありました。

* ACI0101405 オブジェクト型フィールドにコレクションが含まれている場合，`OB Copy`でエンティティをコピーしただけでフィールドが`touched`になりました。
 
* ACI0101706 `New process`で同じ名前のプロセスをほぼ同時に起動した場合，ランタイムエクスプローラーに表示されるプロセス番号が一緒になりました。

**注記**: 不具合は修正されましたが，紛らわしいので，同じ名前のプロセス名を同時に起動することは避けたほうが良いでしょう。

* ACI0101700 バーチャルストラクチャが設定されている場合，ユーザーモードの「ツール」メニューからクイックレポートを開こうとすると，シンタックスエラーが返されることがありました。

* ACI0101719 クライアント/サーバー版のみ。サーバーがリモートデータストアに接続した状態で，`ds`オブジェクトのメンバー関数をコールした場合，ローカルデータストアではなく，リモートデータストアの情報が返されましたs。

* ACI0101740 macOS Big Surのみ。統合Webエリアで [accounts.google.com ](https://myaccount.google.com/) で開こうとした場合，アプリケーションがクラッシュしました。

**注記**: CEF 86は，近隣のスマートフォンを検索するためと思われますが，このページが開かれると自動的にBluetoothを使用するようです。macOS Big Surは，`Info.plist`に必要な`NSBluetoothAlwaysUsageDescription`キーが存在しない場合，Bluetoothにアクセスしようとしたアプリを強制的に終了します。修正により，クラッシュはしないようになりましたが，初回にBluetoothアクセスの許可を求めるダイアログが表示されるかもしれません。

* ACI0098296 `HTTP Get`で [http://maps.googleapis.com](http://maps.googleapis.com) のAPIをコールした場合，ステータスコード`403`を返されました。

* ACI0101622  4D for iOSの「ラベル＆アイコン」セクションでフィールドにカスタムフォーマッターを設定し，「フォーム」セクションでフィールドをモデルにドラッグ＆ドロップした後，「ラベル＆アイコン」セクションでデフォルトのフォーマッターをフィールドに設定した場合，`project.4dmobileapp`ファイル内に不正なフォーマットが記述され，データの同期中にアプリがクラッシュしました。フィールドをモデルから削除し，再度，ドラッグ＆ドロップすれば問題ありません。

* ACI0101617 Mac版のみ。`MSG_Extract`で特定のメールを解析した場合，アプリケーションがクラッシュすることがありました。

* ACI0101605 4D for iOSの「ストラクチャ」セクションでフィルターを使用し，公開したテーブルだけを表示した場合，ランタイムエラーが返されました。

* ACI0101593 クエリエディターで条件に複数の「含む」条件を「または」連結で入力し，ファイルに保存した場合，クエリ条件が正しく再現されませんでした。クエリ条件をファイルから読み込むと，条件が「リスト内にある」に変換され，ペーストボードにコピーすると，条件文字列のワイルドカード文字が失われていることが確認できます。

**注記**: 「または」連結をいくつも入力した場合，クエリエディターが画面に収まらなくなってしまうため，最適化の一環として，条件を「リスト内にある」に変換する措置が講じられていました。

* ACI0101720 4D WriteドキュメントをWrite Proに変換した場合，名称に「Medium」という文字列が含まれるフォントのスタイルが無視されました。たとえば「Yu Gothic Medium」が「Yu Gothic Regular」になりました。

**注記**: 4D Writeからの変換および`.docx`ドキュメントのインポートが修正されました。

* ACI0101576 ランタイムエクスプローラーの表示中に配列の範囲チェックエラーが発生することがありました。
	
* ACI0101701 クライアント/サーバー版のコンパイルモードモードのみ。`entitySelection.orderByFormula()`を実行すると「スタックが一杯」エラーが返されることがありました。入力フォームで問題が再現します。単独でコードを実行した場合は問題ありません。

* ACI0101724 プロジェクトモードのみ。ポップアップメニューの「レンダリングしない」プロパティを有効にした場合，「文字フォーマット」プロパティが非表示になりませんでした。

* ACI0101723 プロジェクトモードのみ。非表示のポップアップ/ドロップダウンメニューをプロジェクトに変換した場合，メニュー項目が正しく表示されませんでした。

* ACI0101716 ドロップダウンメニューまたはコンボボックスに文字フォーマットが適用されませんでした。

* ACI0101715 ドロップダウンメニューの表示フォーマットにユーロ記号が含まれている場合，ユーロ記号が正しく表示されませんでした。

* ACI0101586 クライアント/サーバー版のみ。`SAVE RECORD`を続けて実行した後，`Modified record`が`True`を返しました。ACI0100945が修正されたことによる副作用のようです。

* ACI0097691 Mac版のみ。システム環境設定（キーボード＞ショートカット＞コントロール間のフォーカス移動をキーボードで操作）を有効にしても，タブ操作でポップアップメニューにフォーカスを移動することができませんでした。

<img width="668" alt="スクリーンショット 2021-03-02 10 49 13" src="https://user-images.githubusercontent.com/10509075/109584525-06160b80-7b45-11eb-8edc-c128fe265031.png">

* ACI0101731 コンパイルモードのみ。`EXECUTE FORMULA`で変数を作成し，しばらくアプリケーションを使用していると，変数が未定義になり，シンタックスエラー（未知の変数に対するポインターあるいは不正なポインターの使用）が返されました。

* ACI0101690 コンパイルモードのみ。しばらくアプリケーションを使用していると，変数が未定義になり，シンタックスエラー（未知の変数に対するポインターあるいは不正なポインターの使用）が返されました。macOSではアプリケーションが終了し，Windowsではフリーズしました。ACI0100904に似ていますが，フォームオブジェクトではなく，コンパイルモードで作成したインタープリター変数で問題が発生します。
 
* ACI0101721 Mac版のみ。`MAIL Convert from MIME`を実行した場合，アプリケーションがクラッシュすることがありました。

* ACI0101681 View Proの`getCultureInfo()`が日付フォーマット`dd/mm/yy`を返すようなスプレッドシートであっても，セルに挿入した日付型が`mm/dd/yy`フォーマットで表示されました。

**注記**: SpreadJSは，`sheet.setValue(0,0,new Date()`で挿入した日付は，カルチャーで設定した日付フォーマットではなく，`defaultDatePattern`を使用するようになっています。修正により，4D Viewプラグインのように短い日付フォーマットが適用されるようになりました。 

* ACI0101434 `SQLBindParameter`で送信されるODBCのパラメーターが正しくありませんでした。ACI0101084が修正されたことによる副作用を修正したACI0099846による副作用のようです。


**注記**：`SQLWCHAR`は`1`文字に`2`バイトを使用します。端末のヌル文字を含めた場合，``10``文字は`22`バイトです。ACI0099846で文字数とバイト数が修正されましたが，副作用として文字列と同数の空白が追加されるようになりました。今回，修正されたのは，パディングの問題です。

* ACI0101690 コンパイルモードでしばらくアプリケーションを使用していると，フォームローカル変数に対するポインターが無効になることがありました。

**注記**: 問題は修正されましたが，再コンパイルが必要です。 

* ACI0101540 クライアント側のMSCでデータファイルの検証を実行した場合，サーバーからダウンロードしたログファイルと一緒に`LogStyleSheet.css`が作成されないため，ログファイルを表示することができませんでした。プロジェクトモードでは`Verify_Logs.xml`もダウンロードするためのボタンをクリックすることもできません。

* ACI0101491 配列を参照していないポインター配列の`0`番要素の逆参照に配列の要素番号を変数で渡した場合，エラーが返される代わりに配列の要素番号に使われた変数に値が代入されました。

* ACI0101625 `Content-Type`が`multipart/alternative `のメールを`MAIL CONVERT FROM MIME`で変換した場合，本文のエンコーディングが正しくありませんでした。

* ACI0101456 リストボックスに表示されたカレントセレクションをクエリで更新した直技に`shift`+クリックで行を選択した場合，１番目の行ではなく，最後にクリックした行から`shift`+クリックした行までが選択されました。ACI0101433が修正されたことによる副作用です。

* ACI0101433 `LISTBOX SELECT ROW`でリストボックスの行を選択した後，`shift`+クリックで別の行を選択した場合，正しい範囲の複数行が選択されませんでした。`LISTBOX SELECT ROW`で選択した行ではなく，１番目の行から`shift`+クリックした行までが選択されました，

* ACI0101680 `Is picture file`のアスタリスク（`*`）オプションの振る舞いが仕様と逆でした。たとえばアスタリスク（`*`）オプションを省略し，`.png`拡張子が設定された非画像ファイルを処理した場合，拡張子だけで判定されて`True`が返されるべきですが，`False`が返されました。反対にアスタリスク（`*`）オプションを指定して`.txt`拡張子が設定された画像ファイルを処理した場合，内容に基づいて`True`が返されるべきですが，`False`が返されました。

* ACI0101539 「Welcomeウィザード」の「起動時に表示しない」チェックボックスと「サーバーに接続」ダイアログの「このダイアログを次回起動時に表示」チェックボックスを有効にした場合，「サーバーに接続」ダイアログが次回起動時に表示されませんでした。`.4DPreferences`ファイルの`automatisms@startup_mode`属性が`3`ではなく`0`にセットされるためです。

* ACI0101664 `SHOW PROCESS`で表示したプロセスにウィンドウが最前面に移動しました。
 
* ACI0101696 Windows版のみ。`Open form window`で`Controller form window`を表示した場合，`Plain form window`が表示されました。

* ACI0101676 `WP Get elements`はWrite Proドキュメントのアンカー画像をz-order順に返しませんでした。

**注記**: 修正により，`wk type image anchored`を指定した場合，アンカー画像がz-order順に返されるようになりました。

* ACI0101675 4D WriteドキュメントをWrite Proに変換した場合，アンカー画像のサイズが固定されていたかどうかを判別することができませんでした。

**注記**: 4D Write（`.4W7`）ファイルでアンカー画像のサイズが固定されていなかった場合，幅および高さは`auto`に変換されます。

* ACI0101659 4D WriteドキュメントをWrite Proにインポートした場合，アプリケーションがクラッシュすることがありました。

* ACI0101628 階層リストのデータソース（変数または式）に`Form.var`のようなオブジェクト記法を入力することができませんでした。

* ACI0099816 リストボックスのシングルクリック編集が有効にされている場合，`control`または`shift`キーを押しながら入力不可カラムをクリックして複数の行を選択することができませんでした。クリックしたのが入力可カラムであれば問題ありません。

* ACI0101623 `sk diacritical`という用途の不明な定数が存在しました。

* ACI0101606 View Proエリアのツールバーが使用されている場合，特定のスプレッドシート（`.4VP`ファイル）をインポートすると，`On After Edit`や`On Selection Change`のようなフォームイベントが発生しませんでした。リボンインターフェースでは問題ありません。

* ACI0101488 WebエリアのURLおよび進捗プロパティに`Form`を入力した場合，コマンドがトークナイズされませんでした。

* ACI0101406 バイナリモードのみ。リストボックスのフッターに`Form.property`のようなフォーミュラを入力することができました。ヘッダーやフッターのデータソースに設定できるのは変数だけです。オブジェクト記法が入力された場合，型宣言コンパイラーメソッドに無効な宣言コマンドが出力されました。
