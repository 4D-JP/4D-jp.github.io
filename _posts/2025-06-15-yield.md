---
layout: fix
title: "CPUの独占に注意を喚起するデータベースパラメーター"
date: 2025-06-15 08:00:00
categories: 仕様
tags: programming language performance 
---

アプリケーションをコンパイルせず，[プリエンプティブモード](https://developer.4d.com/docs/ja/Develop/preemptive-processes)のプロセスやワーカーを活用しなかった場合，すべてのメソッドは原則的にメインアプリケーションのコオペラティブスレッドで実行されます。つまり，複数のスレッドで同時に複数のプロセスが実行されるのではなく，メインアプリケーションのコオペラティブスレッドで少しずつ順番に実行されることになります。

コオペラティブモードでは，特定のプロセスが長時間にわたってCPUを独占するようなことを避け，プロセス同士でCPUを譲り合うことが重要です。たとえば，ループ処理中に[`DELAY PROCESS`](https://developer.4d.com/docs/ja/commands/delay-process)を呼び出すことができます。`DELAY PROCESS`が呼び出されると，一旦，スケジューラーに制御が返され，順番を待っている他のプロセスにメソッドを実行する機会が与えられます。プロセスを遅延することは望まず，単純に「息継ぎ」をしたい場合には，遅延時間に`0`を指定します。遅延時間に`0`を指定した場合であっても，必ずスケジューラーに制御返されるからです。

最近，新しい[データベースパラメーター](https://developer.4d.com/docs/ja/commands/set-database-parameter)`Uncooperative process threshold (132)`が追加されました。このパラメーターはメインアプリケーションのコオペラティブスレッドを「独占」しているプロセスを特定するのに役立ちます。閾値（デフォルトは`500`㍉秒）を超えてプロセスがCPUを独占した場合，

```
Cooperative process doesn't yield enough
```

という警告が診断ログに出力されます。閾値はカスタマイズすることができます。また，このメッセージはエラーではなく警告なので，データベースパラメーター`Diagnostic log level (86)`でログレベルを「エラー」に設定することにより，抑制することができます。
