---
layout: fix
title: "4D 20r7 修正リスト"
date: 2024-12-08 08:00:00
categories: 修正リスト
tags: 20r7
build: 100262
version: "20r7"
permalink: /2024/274/:slug/
---

**バージョン**: {{page.version}}  
**ビルド**: {{page.build}} 

* ACI0104274 Windows版のみ。エクスプローラーのウィンドウを最大化したままデザインモードを再起動した場合，エクスプローラーの表示がおかしくなりました。ウィンドウは最大化されていますが，内容がウィンドウサイズに合っていませんでした。

* ACI0105279 Mac版のみ。トラックパッドを使用した場合，スクロールがぎこちない動きになりました。

* ACI0105288 Windows版のみ。CEF版WebエリアのコンテキストメニューにWebインスペクターの項目が表示されませんでした。

* ACI0105275 `ds.setAdminProtection`を`True`に設定しても，*WebAdmin* サーバー経由でプロジェクトのカタログにアクセスすることができました。

**注記**: [`ds.setAdminProtection`](https://developer.4d.com/docs/ja/API/DataStoreClass#setadminprotection)の目的は，IT管理者のように*WebAdmin* のパスワードを変更できる人物がデータを閲覧できないようにすることです。*Qodly Studio* を起動すれば，データを閲覧することができるので，`ds.setAdminProtection`を`True`に設定した場合，*Qodly Studio* に対するアクセスはブロックされます。

* ACI0105268 セレクション型リストボックスをダブルクリックして遷移した詳細フォームでレコードの更新を確定した場合，リストボックスのフッター自動計算が更新されませんでした。

* ACI0105243 *WebAdmin* の設定画面でポート番号を変更し，OKボタンをクリックした場合，値が保存されませんでした。入力エリアからタブ移動すれば問題ありません。

* ACI0105286 フィールドに複合インデックスが設定されていても，クエリでは個別のインデックスが優先的に使用されました。

**注記**: 修正により，比較演算子の`=`または`#`以外の場合は複合インデックスが優先的に使用されるようになりました。

* ACI0105265 Mac版Apple Siliconターゲットのみ。`Try/End try`ブロックの内部に`While` `For` `For each`ループが記述されている場合，コンパイルができませんでした。

* ACI0105237 `HTTPAgent`を使わずに`HTTPRequest`の`certificatesFolder`を指定した場合，`401`エラーが返されました。ACI0104923が修正されたことによる副作用のようです。証明書のパスを`HTTPRequest`ではなく`HTTPAgent`に渡して`keepAlive`を`False`にセットすれば問題ありません。

* ACI0105302 クライアント/サーバー版のみ。HTTPクライアントの`readwriteTimeout`プロパティが無視されました。[テレメトリ](https://developer.4d.com/docs/ja/Admin/data-collect)サーバーがビジー状態の場合，アプリケーションがフリーズする恐れがあります。テレメトリのHTTP送信がコオペラティブプロセスで実行されている点も問題です。

* ACI0105296 クライアント/サーバー版のみ。ファイルメニューの「最近使用したプロジェクト」からプロジェクトを開いた場合，サーバー管理画面に情報が表示されず，終了時にアプリケーションがフリーズしました。「最近使用したプロジェクト」メニューが空であれば問題ありません。

* ACI0105245 クライアント/サーバー版のみ。クライアント側ツールバーの「サーバー管理」ボタンに「MSC」ボタンのアイコンが表示されていました。

**注記**: 4Dを起動した直後は，まだサーバーに接続しておらず，ローカルモードで動いているので，ツールバーにはMSCのボタンが表示されています。サーバーに接続した直後，モードが切り替わったという通知がツールバーに送られますが，ツールバーのステータス変化を伝えるフラグが正しく更新されていませんでした。

* ACI0105199 Mac版のみ。`2^32`文字を超える文字列を変数に代入するような処理や`8`GB以上のキャッシュサイズを利用してインデックスを構築するような処理でメモリのアロケーションに失敗し，アプリケーションがクラッシュしました。[CEFのアップデートが原因](https://github.com/chromiumembedded/cef/issues/3061#issuecomment-2522766138)です。CEFが`malloc` `calloc` `realloc`のハックを実装したため，[`0x7FFFFFFE`を超えるメモリのアロケーションに失敗するとすぐにクラッシュする](https://docs.google.com/document/d/1yKlO1AO4XjpDad9rjcBOI15EKdAGsuGO_IeZy0g0kxo/edit?tab=t.0#heading=h.kh70u1b2uiwm)ようです。

* ACI0105008 Windows版のみ。テキストの*DirectWrite* レンダリングを有効にした場合，「ぶらさがり」文字（`g` `j` `p` `q` `y`）の下端が欠けて表示されることがありました。

**注記**: ボタンおよびポップアップドロップダウンメニューだけが修正されました。*DirectWrite* は，19r3まで使われていたGDIとは文字サイズが違っていることに留意してください。
特に文字の高さと行間の幅はGDIより広いため，*DirectWrite* レンダリングを有効にした場合，過去バージョンではぴったり収まっていたテキストが欠けてしまうかもしれません。それを避けるためには，*DirectWrite* レンダリングを無効にするか，*DirectWrite* 向けにレイアウトを調整する必要があります。

* ACI0105249 Mac版のみ。リードオンリーのドキュメントを`WP EXPORT DOCUMENT`で上書き更新した場合，ファイルのリードオンリーステータスが失われました。

* ACI0105267 "webadmin"権限がなくても，[*WebAdmin* サーバー](https://developer.4d.com/docs/ja/Admin/webAdmin/)の`$catalog/$all`/`$catalog/{tableName}`エンドポイントにアクセスすることができ，`Open datastore`もエラーを返しませんでした。ACI0104937が修正されたことによる副作用です。

* ACI0105231 Windows版のみ。ARMアーキテクチャのオペレーティングシステムでは，*tool4d* が正常に起動しませんでした。再配布ランタイムが不足しているためです。

* ACI0105244 Windows版のみ。未確定の入力文字列を*Backspace* キーで削除した場合，削除されるべき未確定の入力文字だけでなく，その右側にある文字も削除されました。ACI0104443が修正されたことによる副作用です。

* ACI0105233 コンパイルモードのみ。コメントの`//%D`が使用されている場合，アプリケーションがクラッシュする可能性がありました。

**注記**: システムデバッガを起動するためのコメント`//%D`は廃止されました。また，`/* */`ブロックコメント内では特殊コメントの`%R`と`%T`も無視されるようになりました。

* ACI0105106 英語版のみ。フォームウィザードで作成したフォームのブール型変数または式が`True`/`False`ではなく`Vrai`/`Faux`として設定されました。*en.lproj* フォルダーの*CommonEN.xlf* が間違ってフランスに翻訳されているためです。

* ACI0105250 設定画面の「データベース」タブを開こうとした場合，ランタイムエラーが返されました。

* ACI0105213 Macクライアント/サーバー版のみ。`entity.fromObject()`が動作しない場合がありました。データクラス属性の順序が関係しています。ACI0105066が修正されたことによる副作用のようです。

* ACI0105241 バイナリデータベースをプロジェクトに変換した場合，直接型指定モードが有効になりました。

* ACI0105239 Mac版のみ。スモールサイズのチェックボックスまたはラジオボタンを`OBJECT GET BEST SIZE`に基づいてリサイズした場合，オブジェクトがミニサイズに変化しました。

* ACI0105236 Mac版のみ。バイナリデータベースをプロジェクトに変換した場合，フォームに配置されたブール型フィールドが１組のラジオボタンに変換されますが，ラジオボタンの幅が不十分なため，タイトルが完全に表示されませんでした。

**注記**: バイナリデータベースのブール型フィールドは標準サイズのラジオボタンとして表示されますが，プロジェクト変換後のラジオボタンはミニサイズのラジオボタンとして表示されます。

* ACI0105235 Mac版のみ。ミニ・スモール・標準サイズのチェックボックスまたはラジオボタンをフォームエディターに配置した場合，オブジェクト左端の座標が揃いませんでした。

* ACI0105206 プロジェクトをメンテナンスモードで開いた場合，MSCのストラクチャ検査・圧縮・修復ボタンが非アクティブ表示になりませんでした。

* ACI0105201 `entitySelection.toCollection().orderBy()`のようにオブジェクト記法でメンバー関数を連結した場合，関数またはプロパティが想定されていないという警告（`550.3`）が表示されました。

* ACI0105242 Windows版のみ。タスクバーのボタンを「タスクバーに入り切らない場合に結合」に設定し，`SET WINDOW DOCUMENT ICON`でSDIウィンドウのアイコンをカスタマイズした場合，最前面ウィンドウを切り替えてもタスクバーのアイコンが更新されませんでした。

* ACI0105232 v18以前に作成されたデータベースのストラクチャ設定に`automatic_session_management="true"`または`session_mode="1"`が含まれてない場合，ストラクチャ設定には「旧式セッション管理」と表示され，ユーザー設定には「スケーラブルセッション管理」と表示されました。`settings.4DSettings`に項目が存在しない場合，ユーザー設定はストラクチャ設定を継承するべきです。

* ACI0105222 バイナリモードのみ。実数型フィールドに表示フォーマットが設定されていない場合，時間のフォーマットで値が表示されました。

* ACI0105177 Webサービスウィザードの「詳細」ボタンをクリックしても，何も表示されませんでした。

* ACI0105057 ツールボックスの「ユーザー＆グループ」ページを開いた状態でREST APIの認証メソッドを処理した場合，アプリケーションがクラッシュしました。	

* ACI0101678 ビルド版サーバーアプリケーションの設定画面に表示されるデフォルトHTMLルートパスが正しくありませんでした。サーバーアプリケーションの場合，正しいフォルダー名は*Database* ではなく*Server Database* または*Serveur Database* （フランス語版）です。表示上の問題であり，動作には支障ありません。

* ACI0105226 `1024`個のレコードが存在するデータクラスのエンティティをトランザクション中に保存した場合，アプリケーションがクラッシュしました。ORDAではなく，クラシック言語でレコードを保存すれば問題ありません。

* ACI0105214 セレクション型またはエンティティセレクション型のリストボックスで「セレクションハイライトを非表示」を有効にした場合，行をクリックしても*On Display Detail* イベントが発生せず，メタ情報式が評価されませんでした。リストボックスのヘッダーをクリックしたり，ウィンドウをリサイズしたりすれば再描画されます。ACI0105065が修正されたことによる副作用のようです。

* ACI0105212 `Open datastore'でリモートデータストアに接続した場合，*On REST Authentication* データベースメソッドでログインすればセッションタイムアウト（デフォルトは`1`時間）までライセンスが解放されずに保持されますが，*roles.json* と`ds.authentify()`でログインするとセッションのライセンスがすぐに解放されました。

* ACI0105208 リモートデータストア接続の権限を`ds.authentify()`で認証した場合，RESTセッションが`Process activity`や`License info`に反映されませんでした。ランタイムエクスプローラー・デバッガ・サーバー管理画面にも反映されません。

* ACI0105193 `Try/Catch`の構文を入れ子にした場合，シンタックスエラーが返されました。

* ACI0105123 Mac版のみ。ループ処理中に`PDF Get Attachments`を実行した場合，アプリケーションがクラッシュしました。`800`回前後の繰り返しで現象が再現します。

**注記**: 作成したプロセス以外はコールバック関数を保持しないよう，`4D.SystemWorker`が修正されました。

* ACI0104864`This`を参照するフォーミュラ型のプロパティが定義されたクラスを`OB Copy`でクローンしようとした場合，アプリケーションがクラッシュしました。

* ACI0105191 コンパイルモードのみ。`method`プロパティに`method.4dm`が設定された*form.4Dform* ファイルを`/RESOURCES/`フォルダーに置き，`DIALOG`や`Print form`にパスを渡して実行した場合，フォームメソッドが実行される代わりに「{アプリケーション名}について…」画面が表示されました。

**注記**: コンパイルモードのフォームからコンパイルされていないフォームメソッドを実行しようとするべきではありません。

* ACI0105202 Windows版のみ。MDIウィンドウのアイコンを`SET WINDOW DOCUMENT ICON`（ウィンドウ番号`-1`）でカスタマイズすることができませんでした。

* ACI0105203 `IMPORT DATA`による長文のインポートで文字化けが発生することがありました。UTF-8文字列の長さが割り切れない場合に問題が生じました。

**注記**: ACI0103521が修正されたことにより，これまで目立たなかった不具合が明らかになりました。ACI0103521の修正以前は，文字化けが生じない代わりに，長文のインポートでバッファサイズを超過するテキストが失われていました。

* ACI0105204 ラジオボタンまたはチェックボックスに日本語`1`文字だけのタイトルが設定されている場合，正しく文字が表示されませんでした。

* ACI0105189 Write Proドキュメントのヘッダーに表を挿入し，その表に対して`WP Get position`を実行した場合，アプリケーションがクラッシュしました。

* ACI0105183 Macクライアント/サーバー版のみ。サーバーがフリーズすることがありました。コオペラティブプロセスのスケジューラーがデッドロックに陥る条件があるようです。

* ACI0105175 複数の段落が選択された状態でWrite Proエリアに対して`Get action info`を実行した場合，`status`に`"mixed"`が返されませんでした。また，マージン情報は選択の冒頭にある段落のものが返されました。

**注記**: 問題は修正されましたが，パフォーマンス最適化のため，指定されたレンジの冒頭`2000`文字に基づいて`"mixed"`かどうかが判定されます。それよりもおおきなレンジの場合，正しい`status`が返されないかもしれません。

* ACI0105174 フォームに複数のWrite Pro標準アクションオブジェクトが存在する場合， `Get action info`から返されるWrite Proエリアの標準アクション情報が正しく更新されないことがありました。

* ACI0104919 スタートアップ直後のアクティビティが診断ログに記録されないことがありました。

**注記**: ロガーには`1000`項目分のフレームバッファが設定されています。短時間に`1000`以上のアクティビティログを出力した場合，もっとも古いアクティビティは記録されないかもしれません。4D 20は，4D 19よりも動作が速いため，この上限に達する可能性が高くなりました。修正に伴い，この上限値が見直されました。

* ACI0105136 Windows版のみ。プロジェクトを開いたことがない状態で環境設定にアクセスした場合，POSIXパスが無効であるというエラーが返されました。20r7ではクラッシュするかもしれません。

* ACI0105084 `POP3 Transporter`でメール受信に失敗した場合，メモリーリークが発生しました。接続オブジェクトとそのバッファが解放されていないためです。他のトランスポーターでも問題が再現します。

* ACI0105210 フランス語版のみ。アプリケーションビルド画面の「コード署名」の説明文が正しくありませんでした。正しいフランス語は*le processus requière* ではなく*le processus requiert* です。

* ACI0104992 `QR REPORT`の画面にストラクチャとバーチャルストラクチャの表示名が混在していました。

* ACI0105176 Write Proエリアの編集中に違うヘッダーの同じ相対位置にカーソルを移動してテキストを挿入した場合，*On Selection Change* イベントが発生しませんでした。

* ACI0104443 セレクション型リストボックスセルの*On Before Keystroke* イベントで`FILTER KEYSTROKE("")`を実行した場合，セルの内容が消去されました。

* ACI0105179 トランザクション中に更新されたエンティティがメモリから解放されるタイミングでアプリケーションがクラッシュすることがありました。

* ACI0105031 Write Proエリアのサイドウィジェットで`method4D:myAlert?parameter='Hello%20World!'`のようなメソッドのハイパーリンクを設定することができませんでした。

* ACI0105192 バイナリモードのみ。リストボックスの日付型カラムまたはフッターに表示フォーマットを設定した場合，日付の代わりに"todoicu"という文字列が表示されました。プロパティリストではなく`OBJECT SET FORMAT`を使用すれば問題ありません。

**注記**: 問題は修正されましたが，すでに"todoicu"という文字列がプロパティリストに登録されている場合，表示フォーマットを設定しなおす必要があります。

* ACI0105184 空のテーブルに対してLooker REST APIでアクセスした場合，リレーション属性の名前ではなく，そのテーブルの名前がスキーマとして返されました。

* ACI0105171 Windows版のみ。`0`°以外の向きに設定されたスタティックテキストに対して`OBJECT SET HORIZONTAL ALIGNMENT`を使用した場合，水平揃えを変更できませんでした。

* ACI0105064 SOAPサーバーがXML External Entity (XXE) 攻撃の標的になる可能性がありました。

* ACI0104985 *Excel* などのOfficeデスクトップアプリケーションから*Power Query* でSQLを実行した場合，`5`桁を超える数値が正しく返されませんでした。*MS Query* であれば問題ありません。

* ACI0104819 *Qodly Studio* のみ。新規プロジェクトを作成した場合，*Shared* フォルダーが自動的に作成されないため，コンポーネントをアップロードすることができませんでした。

* ACI0105125 `3`個以上のカラムに跨る段落が存在し，サブセクションのカラム数がそれぞれ違う場合，Write Proドキュメントのレイアウトが正しくありませんでした。

* ACI0105065 コレクション/エンティティセレクション型リストボックスの「自動行高」および「セレクションハイライトを非表示」を有効にした場合，リストを下方向にスクロールした後，行をクリックすると，上方向にリストがスクロールしました。配列型リストボックスでは問題ありません。

* ACI0105022 UUIDフィールドに対し，空の文字列を含むコレクションを使用してORDAクエリを実行した場合，間違った結果が返されました。

* ACI0105167 ラジオボタンまたはチェックボックスのタイトルが`1`文字の場合，タイトルの前にコロン記号（`:`）が追加されました。

* ACI0105163 抑制できるコンパイラー警告のリストに抑制できないエラーの番号も含まれていました。

* ACI0105161 ツールボックスの「ユーザー＆グループ」ページでグループ名をダブルクリックしてから項目を更新した場合，変更が反映されませんでした。コンテキストメニューを使用すれば問題ありません。

* ACI0105158 空のテーブルに対してLooker REST APIでアクセスした場合，スキーマが返されませんでした。

* ACI0105068 Qodly Studioのみ。データモデルクラスのメンバー関数とは違い，シングルトンのメンバー関数は`filePath` `startingLine` `endingLine`などのメタ情報がサーバーから返されませんでした。

* ACI0105157 Looker REST API（`$format=looker`）とドット記法でオブジェクト・BLOB・ピクチャ型のリレーション属性にアクセスした場合，エラー`400`ではなく`[]`が返されました。

* ACI0105105 パラメーターのない`exposed`属性のシングルトン関数にREST APIでアクセスした場合，エラーが返されました。明示的に空のリスト`[“”]`をHTTPリクエストで送信すれば問題ありません。

* ACI0105172 Mac版のみ。WindowsのプロジェクトフォルダーをSMBまたはCIFSで共有し，Macから開発モードを有効にして開こうとした場合，アプリケーションがクラッシュしました。プロジェクトフォルダー自体ではなく，その親フォルダーを共有すれば問題ありません。

* ACI0103752 4D ViewスプレッドシートをView Proに変換した場合，パーセンテージのフォーマットが正しく適用されませんでした。

* ACI0105100 リレーション属性が関係するORDAクエリが間違っていることがありました。ACI0104799が修正されたことによる副作用のようです。

```4d
ds.One.all().drop()
ds.Many.all().drop()
$One:=ds.One.new()
$One.Id:=1
$One.save()
$Many:=ds.Many.new()
$Many.Id:=1
$Many.OneId:=1
$Many.save()
$Query:="One.Id#0 & ((Id#0 & (Id=0 | One.Id=0)) | (Id#0 & (Id=0 | One.Id=0)))"
ALERT($Query+"\r\rExpected: 0\rResult: "+String(ds.Many.query($Query).length))
```

* ACI0105132 特定のドキュメントをWrite Proの埋め込みモードに表示することができませんでした。埋め込みモードでは，水平スクロールが常に表示され，自動改行モードがオフになることが関係しています。

* ACI0105074 フォルダー名に日本語やウムラウト記号のような拡張文字が含まれているWindowsの共有フォルダー（サブフォルダーではない）をSMBでMacでマウントした場合，エラーになりました。Windows同士，あるいはMacからWindowsの共有であれば問題ありません。ACI0104219が修正されたことによる副作用のようです。

* ACI0105061 `300,000`件以上のレコードがすでに登録されているフィールドの「ヌル値を空値にマップ」プロパティを有効に変更して，`QUERY WITH ARRAY`または`QUERY SELECTION WITH ARRAY`でシーケンシャルクエリを実行した場合，正しい結果よりも`1`件レコードが少ないセレクションが作成されました。

* ACI0105153 Mac版のみ。パレットタイプのウィンドウ（*Controller form window* *Pop up form window* *Toolbar form window* *Palette form window*）をフォーカスした場合，フォーカスされていないウィンドウのデフォルトボタンのタイトルがボタンと同色になりました。ダークモードでは問題ありません。

* ACI0105027 フォームエディターのコンテキストメニューで「同じ種類のオブジェクトを選択」した場合，ツールバーの整列/均等配置ボタンがアクティブ化されませんでした。

* ACI0105143 バイナリモードのみ。20r6以降，フォームに配置したピクチャの表示フォーマットが*Scaled to fit prop centered (6)* から*Truncated non centered (1)* に変わってしまうことがありました。

**注記**: ピクチャの表示フォーマットは文字列の表示フォーマットと同じように指定しますが，フォームオブジェクトのタイプを途中で変更した場合，ピクチャには適用できないはずの値が残されている可能性がありました。修正により，表示フォーマットの値だけでなく，オブジェクトのタイプもチェックされるようになりました。

* ACI0105126 アプリケーションまたはコンポーネントをビルドした場合，*.4DZ* ファイルの中に*dependencies.json* ファイルが含まれていました。

**注記**: `BUILD APPLICATION`が修正されました。もっとも*.4DZ* ファイルの中に*dependencies.json* ファイルが含まれていたとしても動作に影響はありません。

* ACI0105140 Windows版のみ。Windows 24H2で印刷コマンドを実行してPDFを出力しようとした場合，`OPEN PRINTING JOB`からエラーが返されることがありました。

* ACI0105142 メソッドエディターのオートコンプリートが原因でアプリケーションがクラッシュすることがありました。バックスペースキーで`var`構文で宣言した変数に代入する初期値のローカル変数を削除した後，再び`$`記号を入力したタイミングで発生します。

* ACI0105119 バイナリモードのみ。エクスプローラーのごみ箱をクリックせず，マウスオーバーした状態でコンテキストメニューを表示した場合，「ごみ箱に移動する」ではなく「ごみ箱を空にする」というメニューが表示されました。

* ACI0105072 ネットワークに接続していない環境でライセンスのアクティベーションを試みた場合，エラーメッセージが英語で表示されました。

* ACI0105128 *OAuth2* トークンと`SMTPTransporter`で*Gmail* を送信した場合，受信者のメッセージにBccヘッダーが表示されました。ACI0104608が修正されたことによる副作用です。

**注記**: 本来，Bccヘッダーはメールサーバーが除去するべきですが，すべてのメールサーバーがそのように設計されているわけではないようです。修正により，JMAPメッセージオブジェクトから変換されたMIMEにはBccヘッダーが含まれない仕様に戻されました。*NetKit* のように，MIMEにBccヘッダーを含める必要がある場合，下記のようにオプションで指定することができます。

```4d
MAIL Convert to MIME($inMail; {includeBccHeaders: True})
```

`SMTPTransporter`もメッセージからBccヘッダーを取り除くように改良されました。

* ACI0105108 `Get monitored activity`から`message`プロパティを持たない（したがって調査の助けにならない）統計情報が返されることがありました。

* ACI0105130 `TODO`コメントにセミコロン記号（`;`）を含めた場合，メソッドエディターのツールバー表示が乱れました。記号がポップアップメニューのメタ文字として処理されるためです。

* ACI0105091 *Qodly* の標準アクションで強制ログインモードのセッションをログアウトした場合，権限がクリアされませんでした。`ds.logout()`でセッションをログアウトすれば問題ありません。

* ACI0105081 データモデルクラスのメンバー関数に「昇格」アクションを設定した場合，関数の実行中に`Session.hasPrivilege()`が一時的な権限の情報を返しませんでした。

* ACI0105121 ストラクチャファイルを20r6にアップグレードした後，起動時にストラクチャファイルをアップグレードするかどうかを尋ねるダイアログが表示されました。

* ACI0105137 順列ありエンティティセレクションに対して`entitySelection.clean()`を使用した場合，トランザクション中に削除されたエンティティがエンティティセレクションから除外されず，その位置に`Null`が返されました。

* ACI0105118 レコードアドレスが`32`ビットの範囲を超える場合，`entitySelection.clean()`が正しく動作しませんでした。

* ACI0105038 行高の管理配列が設定されたリストボックスのスクロール速度が列数に比例して低下しました。列数が`100`個以上の場合に問題が顕著です。行の高さが固定あるいは自動であれば問題ありません。