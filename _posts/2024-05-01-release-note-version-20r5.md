---
layout: fix
title: "4D 20r5 修正リスト"
date: 2024-06-05 08:00:00
categories: 修正リスト
tags: 20r5
build: 100166
version: "20r5"
permalink: /2024/122/:slug/
---

**バージョン**: {{page.version}}  
**ビルド**: {{page.build}} 

* ACI0104832 サーバー側のメンバー関数で作成した新規エンティティを`WebForm`側のアクションで保存することができませんでした。

* ACI0104717 *$format=looker*を指定したRESTリクエストのJSONレスポンスが正しく[エスケープ処理](https://support.google.com/looker-studio/answer/10495775?hl=en)されていませんでした。

* ACI0104836 Windows版のみ。クエリエディターでブール型のフィールドを指定した場合，二択のポップアップメニューが表示されませんでした。

* ACI0104828 *.4DZ* 形式にビルドしたプロジェクトの*$shared* 仮想フォルダーに*Qodly* からアクセスできませんでした。

* ACI0104833 QUICレイヤーのみ。テーブルにレコードを追加するたびにメモリーリークが発生しました。

* ACI0104845 バイナリモードのみ。トレース中に追加したブレークポイントが保存されませんでした。

* ACI0104837 Windows版のみ。過去バージョンのバイナリモードでコンパイルされたコンポーネントメソッドをコンパイルモードで実行した場合，アプリケーションがクラッシュすることがありました。ポインター型パラメーターの逆参照に問題があるようです。Macでは「再コンパイルが必要です」というエラーが返されます。

**注記**: 修正により，v14以前にコンパイルされたコンポーネントを開こうとした場合，再コンパイルを促すメッセージが表示されるようになりました。

* ACI0104814 「サーバー側で実行」メソッドを実行中のサーバー側プロセスを強制的に終了した場合，プロセス名が管理画面の「プロセス」ページから消えませんでした。

* ACI0104785 新ネットワークレイヤーのみ。複数のクライアントが接続された状態で負荷のかかる処理を長時間にわたって実行した場合，クライアントがクラッシュする可能性がありました。

* ACI0104406 テーブルに複合インデックスが設定されている場合，`QUIT 4D`の実行後にアプリケーションがフリーズすることがありました。

* ACI0104813 クライアント/サーバー版のみ。リレーションエンティティを作成する前に新規エンティティのリレーション属性に外部キー値を代入してエンティティを保存した場合，代入した外部キー値ではなく空値が保存されました。

* ACI0104802 開始時にWebサーバーを起動しない限り，*WebAdmin* ポート（デフォルトは`7443`）経由で`$shared`フォルダーにアクセスすることができませんでした。

* ACI0104747 `VP Convert to picture`でView Proスプレッドシートの一部分をSVGピクチャに変換した場合，View Proエリアとは違うフォントが使われることがありました。

**注記**: CEFとピクチャではフォールバックフォントが違うことが関係しています。修正により，*Calibri* がインストールされていない環境では *Helvetica Neue* が使用されるようになりました。

* ACI0104724 `Get process activity`から返されるストアドプロシージャセッションの`userName`が空でした。カレントユーザーが返されるべきです。

* ACI0104749 ネットワーク接続に問題がある環境で`4D.HTTPRequest`を使用した場合，レスポンスが返されるまでに`72`秒（IPv4）または`81`秒（IPv6）を要しました。劣悪なネットワーク接続は[clumsy](https://jagt.github.io/clumsy/index.html)でエミュレーションすることができます。

* ACI0104453 コンパイルモードのみ。別々のプリエンプティブWebプロセスから`Storage`経由でオブジェクトまたはコレクションにアクセスする処理が引き金となってアプリケーションがクラッシュする可能性がありました。

* ACI0104800 RESTでフェッチしたエンティティをデバッガでトレースした場合，計算属性を評価しようとしたところでアプリケーションがクラッシュしました。メンバー関数のコードに`TRACE`が記述されていなければ問題ありません。

* ACI0104782 *WebSocket* に接続して`30`秒ほど放置した場合，エラー`1006`「異常終了（終了フレームが送信または受信されませんでした）」が返されました。

* ACI0104447 `CREATE INDEX`でインデックス設定を更新した場合，ストラクチャエディターには変更が反映されますが，SQLシステムテーブルはプロジェクトを再起動するまで更新されませんでした。

* ACI0104342 コンパイルモードのみ。`SET HELP MENU`でインストールした*ak msc* アクションをサーバー側のヘルプメニューから実行した場合，ランタイムエラーが返されました。`INVOKE ACTION`を実行するための`4D_Server_Interface`ワーカーがプリエンプティブプロセスで起動されているためです。

* ACI0104596 [サーバー側のORDAリクエストログ](https://developer.4d.com/docs/ja/Debugging/debugLogFiles/#サーバー側)に`ipAddress`（クライアントのIPアドレス）が出力されませんでした。

* ACI0104758 プロジェクトモードのみ。互換性の「[ピリオドとカンマを数値フォーマットのプレースホルダーとして使用する](https://doc.4d.com/4Dv20/4D/20.2/Compatibility-page.300-6750362.ja.html)」が無効にされているストラクチャーをプロジェクトに変換した場合，ピリオドや空白を桁区切りとして使用するシステムで`####0,00%;-####0,00%;0,00%`のようなフォーマットを`String`関数で数値に適用した場合，カンマが小数点ではなく，桁区切り記号として処理されるようになりました。

**注記**: プロジェクトモード変換の仕様が変更されました。以前は「ピリオドとカンマを数値フォーマットのプレースホルダーとして使用する」が強制的に有効化され，変換ログにも下記の警告が出力されました。

```json
{
  "message": "Compatibility setting 'Use period and comma as placeholders in numeric formats' switched on.",
  "severity": "warning"
}
```

修正により，この設定は保持されるようになりました。プロジェクトモード変換後にデータベース設定で有効化することができます。

* ACI0104752 Write Proの小数点タブが文字列の後に続くスペースに対して適用されませんでした。Microsoft Wordと同じように処理されるべきです。
 
### Write Pro（修正前）
![](https://github.com/4D-JP/4D-jp.github.io/assets/10509075/8b231b0e-865b-45b3-838d-150bb77cc959)

### Word（参考）
![](https://github.com/4D-JP/4D-jp.github.io/assets/10509075/8a57fcba-f1c6-4277-a2bc-afb77f219d17)

* ACI0104764 Windows版のみ。Write Proドキュメントを*wk pdf* 形式でエクスポートした場合，Unicodeの結合文字を使用したウムラウトが正しい位置に表示されませんでした。プリンタードライバー経由でPDFを出力すれば問題ありません。

**注記**: [Hummus PDF-Writer](https://github.com/galkahana/PDF-Writer/issues/251)の不具合でした。レンダリングの問題を回避するため，合成文字のウムラウトが出力されるようになりました。

* ACI0104698 Mac版のみ。*Modal form dialog box* タイプのウィンドウからポップアップウィンドウを表示した場合，テキスト入力オブジェクトに数字をタイプ入力することができませんでした。

**注記**: Appleの仕様では非アクティブのウィンドウにフォーカスを設定することはできないことになっていますが，4Dはポップアップウィンドウが非アクティブであってもタイプ入力ができる（したがってフォーカスを設定することができる）仕様になっています。今回の修正には，Appleの仕様を迂回することが関係しています。IMEは，非アクティブであるポップアップウィンドウの背後に表示されるので，隠されてしまわないよう，ポップウィンドウにテキストを入力している間はウィンドウの外に表示されます。過去バージョンの動作を再現するために問題は修正されましたが，テキスト入力が必要であれば，ポップアップウィンドウではなく，フローティングウィンドウを使用することが勧められています。

* ACI0104669 メソッドエディター上で`Case of`構文の条件ブロックを畳んだ状態で別の条件ブロックカットまたは削除し，`command`+`Z`で操作を取り消した場合，コードが正しく復元されませんでした。

* ACI0104797 Windows版のみ。`GET SERIAL PORT MAPPING`で`COM9`より高いポートを取得することができませんでした。

* ACI0104789 Windows版のみ。`SET PRINT OPTION`で設定した*Orientation option* の設定が`QR RUN`で出力したレポートの`2`ページ目以降に反映されませんでした。PDF/XPSに出力した場合は問題ありません。なお，印刷ジョブを開始する前に用紙の方向を設定すれば問題ありません。

**注記**: Direct2Dモードで印刷中に用紙の方向を変更した場合の処理が修正されました。

* ACI0104603 フォームエディターのプロパティリストで関連メニューバーを「なし」に設定した場合，*form.4DForm* ファイルの`menuBar`プロパティが*none* に更新され，プロパティリストのラベル表示がエラーを意味する赤いタイトル文字に変化しました。関連メニューバーを「なし」に設定した場合は値が空になるべきです。

**注記**: 問題は修正されましたが，すでにメニューバーが*none* に設定されている既存のフォームは修正されません。なお，プロパティリストにおける表示上の不具合であり，動作には問題ありません。手作業で修正するには，有効なメニューバーを設定した後，*control* キーを押しながらプロパティリストのラベルをクリックして設定をクリアしてください。

* ACI0104496 QUICレイヤーのみ。スリープモードから復帰したクライアントのサーバー側プロセスが正常に終了しませんでした。

* ACI0104739 Mac版コンパイルモードのみ。ストアドプロシージャーをアボートした場合，クライアント側にエラーメッセージが表示されませんでした。

* ACI0104771 セレクション型リストボックスのハイライトセットが設定されていない場合，選択されたレコードを標準アクションの「サブレコード削除」または`INVOKE ACTION`で削除することができませんでした。

* ACI0104686 CSSの`verticalAlign`プロパティを使用してリストボックス列の垂直揃えを設定した場合，フォームエディターのプレビュー表示にプロパティが反映されませんでした。フォーム実行時のレンダリングは問題ありません。

* ACI0104654 QUICレイヤーのみ。クライアント側で新規プロセスを起動し，時間を要するクエリを実行した場合，サーバー側のプロセス名が管理画面に約`10`秒間だけ表示され，その後に消えました。ネットワーク帯域を制限するリミッターを有効化し，転送されるデータをおおきくすることで現象を再現できます。サーバー側のプロセス名はクエリが完了するまで表示されているべきです。

* ACI0104597 *On Server Startup* データベースイベントで新規プロセスを起動して開いたウィンドウのオブジェクトメソッドで`OPEN ADMINISTRATION WINDOW`を実行した場合，何も起きませんでした。

**注記**: 管理ウィンドウはヘルプメニューのショートカットで開くことができますが， プロセスにメニューバーがインストールされておらず，フォームにメニューバーが関連付けられていない場合，管理ウィンドウを開くためのメニューコマンドが処理されないことが原因でした。パレットタイプのウィンドウであれば，アプリケーションプロセスのメインメニューが使用されます。修正により，どちらのケースでも管理ウィンドウが表示されるようになりました。

* ACI0104491 QUICレイヤーのみ。ストアドプロシージャーを強制的にアボートした場合，クライアント接続が切断されました。エラー`-1000`「ユーザーにより処理が中断されました」が返されるべきです。

* ACI0104760 *Qodly Studio* のモデルエディターでカタログを編集していると，パーミッション設定が失われ，設定を復元するためにはサーバーを再起動しなければならないことがありました。ACI0104330が修正されたことによる副作用のようです。

* ACI0104805 ビルド版シングルユーザーアプリケーションで`WEB START SERVER`またはデータベース設定の「開始時にWebサーバーを起動」を使用した場合，アプリケーションがクラッシュすることがありました。

* ACI0104788 ツールボックスの「リスト」ページに移動するとランタイムエラーが表示されました。

* ACI0104751 Webリクエスト処理中にWebサーバーを停止しようとした場合，アプリケーションがクラッシュしました。

* ACI0104775 メールオブジェクトをMIME形式に変換した場合，`messageId`の値に余計なエンコードが適用されました。

**注記**: 修正により，`Message-ID`ヘッダーは`76`文字を超過しても折り返されないようになりました。

* ACI0104744 デバッガでメソッドをアボートした場合，ネットワークエラーが*Qodly Studio* に返されました。

**注記**: 修正により，エラーではなくレスポンスとして`{"result":null}`が返されるようになりました。

* ACI0104730 データエクスプローラーの詳細フォームに`<script>`タグを利用して*JavaScript* コードを実行させることができました。

* ACI0104753 ループ処理で`HTTP Get`を実行した場合，`Content-Length`ヘッダーがリセットされませんでした。

* ACI0104765 コンパイルモードのみ。`WebServer.start()`あるいは`WebServer.stop()`を繰り返し実行した場合，アプリケーションがクラッシュすることがありました。

* ACI0104705 新規エンティティを保存するとピクチャ属性が*Qodly Studio* の`image`コンポーネントに表示されなくなりました。

* ACI0104683 新規エンティティを保存するまでピクチャ属性が*Qodly Studio* の`image`コンポーネントに表示されませんでした。

* ACI0104773 Windows版のみ。ビルド版のクライアントでビルド版のサーバーに新ネットワークレイヤーで接続できませんでした。QUICレイヤーでは問題ありません。

* ACI0104188 フィールド値に`<`または`>`記号が含まれている場合，データエクスプローラーの表示が崩れました。

* ACI0104548 *Qodly Studio* にアクセスした場合，RESTセッションが開始されませんでした。ACI0104503が修正されたことによる副作用のようです。

* ACI0104768 クライアント/サーバー版のみ。入力フォームに配置されたチェックボックス（リレーションフィールド）が原因でアプリケーションがクラッシュすることがありました。ACI0104414が修正されたことによる副作用のようです。

* ACI0104759 クライアント/サーバー版のみ。`SET AUTOMATIC RELATIONS(True; False)`でリレーション設定を変更することができませんでした。ACI0104414が修正されたことによる副作用のようです。

* ACI0104754 テンキーの*enter* を入力した場合，データエクスプローラーのウィンドウが閉じられました。

* ACI0104750 クライアント/サーバー版のみ。終了時にサーバーがクラッシュすることがありました。

* ACI0103856 必要なコンポーネントがインストールされていないプロジェクトを*tool4d* で開いた場合，コンソールにエラーメッセージを出力せず，そのままアプリケーションが終了しました。

* ACI0104703 ストラクチャエディターでフィールドの「重複不可」属性を有効にした後，変更前のデータファイルを開いた場合，ストラクチャエディターとカタログファイルの間で齟齬が発生しました。ストラクチャエディターには起動時のカタログファイルの設定（「重複不可」属性は有効）が表示されますが，カタログファイルはデータファイルの設定（「重複不可」属性は無効）で更新されました。ACI0104582と似ていますが，別の問題です。

* ACI0104542 `entity.save()`したリレーション属性のＮフィールドに`Null`を代入することができませんでした。１フィールドがプライマリーキーでなければ問題ありません。

* ACI0104755 Qodly Studioの*$shared* 仮想フォルダーが*webAdmin* ポートを介して配信されませんでした。ACI0104622が修正されたことによる副作用です。起動時に*webAdmin* サーバーを開始していれば，問題ありません。

* ACI0104290 ビット`4` (`16`) を指定せずに *Current process debug log* を有効化した場合，プラグインコマンドの呼び出しでアプリケーションがクラッシュしました。さきに全プロセスのデバッグログを有効化していれば問題ありません。

* ACI0104746 クライアント/サーバー版のみ。コンパイルを実行してからコンパイルモードでプロジェクトを再起動した場合，クライアントアプリケーションがそのまま終了することがありました。

* ACI0104706 クライアント/サーバー版のみ。アプリケーション再起動時にクライアントまたはサーバーがクラッシュすることがありました。`Session`オブジェクトの仕様変更が関係しています。

* ACI0104731 `var`シンタックスで変数の宣言と初期化を記述し，タイプとして小文字の`4D.folder`または`4D.file`を記述した場合，コンパイラーが問題を検出しませんでした。変数の宣言だけであれば，未知のクラスであるという警告が表示されます。ACI0104606が修正されたことによる副作用です。