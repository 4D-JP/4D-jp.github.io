---
layout: fix
title: "4D v18 修正リスト"
date: 2020-04-09 08:00:00
categories: 修正リスト
tags: "18.1"  
build: 250865
version: 18.1

---

**バージョン**: {{page.version}}  
**ビルド**: {{page.build}}  

* ACI0100636 バックアップから復元した後，あるいはアプリケーションを再起動した後，4D for iOSがレコードの同期に使用する管理用テーブル（__DeletedRecords）の管理用フィールド（__GlobalStamp）が正しく更新されませんでした。

* ACI0100611 4D Write Proエリアのコンテキストメニューを無効にした場合，ルーラーのコンテキストメニューも無効になりました。

* ACI0100609 ``WP EXPORT VARIABLE``でMIMEエクスポートしたHTMLをトランスポーターで送信した場合，メールクライアントに本文が正しく表示されないことがありました。Unicodeのバイト・オーダー・マークに続き，HTMLのソースコードがそのまま``ï»¿<html xmlns=...``のように表示されます。受信者がKerioのメールサーバーを使用している場合に問題が発生します。Exchangeサーバーであれば問題ありません。

**注記**: 修正により，Write ProのMIMEエクスポートには，BOMが出力されないようになりました。

* ACI0100669 Webサーバーに対し，HTTPの``PATCH``メソッドを送信した場合，``On Web Connection``が実行されませんでした。即座にエラー``501``が返されます。

* ACI0100651 コンパイルモードで``ARRAY LONGINT``を``VARIABLE TO BLOB``でBLOBに変換した後，``BLOB TO VARIABLE``で``ARRAY REAL``に復元した場合，配列が部分的に変換されました。インタープリターモードでは問題ありません。

**注記**: ドキュメントに明記されているように，BLOBに出し入れする変数・配列の型は，本来，一致していなければなりません。修正により，互換性のある値は，自動的に変換されるようになりました。``BLOB TO VARIABLE``は，インタープリターモードと同じように整数と実数を扱うことができます。

* ACI0100625 ``ZIP Create archive``のオプションで指定したコールバックフォーミュラが処理中に呼ばれませんでした。

* ACI0100612 ``ZIP Create archive``に``ZIP Without enclosing folder``オプションを指定した場合，``success``に``True``が返されますが，アーカイブは作成されませんでした。

* ACI0100654 プロジェクトモードのみ。リストボックス列のプロパティ「エリプシスで省略」が効きませんでした。「ワードラップ」プロパティがデフォルトで「自動」に設定されているためです。

* ACI0100638 プロジェクトモードのみ。バイナリデータベースをプロジェクトにエクスポートした場合，リストボックス列の「交互に使用する背景カラー」プロパティがデザインモードに反映されませんでした。

* ACI0100637 クライアント/サーバー版のみ。クライアント側でWebサーバーを公開した場合，`` http://host/rest``から始まるURL（たとえば``/restaurant``）がハンドルできませんでした。``/rest/``が予約されたURLであることは理解できますが，URLコンポーネントが前方一致するだけであれば，``403``を返すのではなく，通常のURLとして扱われるべきです。

* ACI0100614 ORDAのクエリ条件に``NOT IN :1``と記述し，空のコレクションを渡した場合，``0``件のエンティティセレクションが返されました。期待されるのは，すべてのエンティティが返されることです。

* ACI0100604 ``SMTP Transporter``で送信したメール本文の行が``80``文字を超過する場合，余計な空白文字が挿入されました。

* ACI0100597 ダイナミックフォーム（JSONフォーム）で``EXPORT TEXT``を実行することができませんでした。ファイルは作成されますが，データが出力されません。

**注記**: 修正により，JSONフォームだけでなく，プロジェクトモード全般で``EXPORT TEXT``が使用できるようになりました。

* ACI0100567 クイックレポートで出力したHTMLに問題がありました。余分な``<BR>``タグが大量に出力されます。列やレコードの数に比例するようです。

* ACI0100543 SQLステートメントの構文エラーが引き金となって，エラー処理メソッドがコールされた場合，トランザクションレベルがロールバックされました。

* ACI0100469 本文がないメールを``MIME Convert from MIME``で処理した場合，エラー``-10718``が返されました。

* ACI0099888 クライアント/サーバー版のみ。``dataClass.query()``および``entitySelection.query()``のクエリ条件文字列の末尾に``order by``キーワードを記述した場合，空のエンティティセレクションが返されました。

* ACI0089985 32ビット版のみ。インポートプロジェクトファイル（``.4SI``）に保存した設定を読み込んだ場合，テーブル作成，テーブル名，エンコーディング，列名をフィールド名にバインドなどのパラメーターが正しくダイアログにセットされませんでした。

* ACI0100671 ``VP Export to object``から返されるオブジェクトは，日付の``formatInfo``が正しくありませんでした。

* ACI0100638 プロジェクトモードのみ。リストボックス列の「交互に使用する背景色」がデザインモードでは表示に反映されませんでした。

* ACI0100633 Mac版のみ。リスト型のサブフォームからダイアログを表示した場合，裏に隠れたサブフォームの行が選択された行以外は表示から消えました。

**注記**: 「リスト編集可」モードのリストフォーム全般の問題でした。

* ACI0100616 Write ProドキュメントをMIMEにエクスポートした場合，インライン画像が``Content-Disposition``が``inline``に設定されていませんでした。

* ACI0100608 WriteからWrite Proに変換されたドキュメントには，非表示の特殊文字（ドットで存在が確認できる）が挿入されていることがありますが，その行で``return``（``enter``ではない）キーを入力した場合，改行コードではなく，その特殊文字が挿入されました。

* ACI0100600 バイナリデータベースをプロジェクトに変換した場合，メソッドのオーナーグループやアクセスグループの設定が属性としてエクスポートされ，Webサーバー経由のコール（``4DACTION/``など）のアクセス制限に使用されました。プロジェクトモードでは，ユーザー＆グループの設定が適用されないはずです。

**注記**: 修正により，グループの設定は，エクスポートから除外され，仮に存在したとしても，実行時には無視されるようになりました。変換をやり直す必要はありません。

* ACI0100599 バイナリデータベースをプロジェクトに変換した場合，メソッドのオーナーグループやアクセスグループの設定が属性としてエクスポートされました。

* ACI0100592 Mac版のみ。``OBJECT SET FONT STYLE``でリストボックスの列をシステムフォントをボールド体に設定した場合，リストボックスの表示が次第に遅くなりました。システムにインストールされているフォントの数に比例して問題が深刻になります。

* ACI0100581 サーバーアプリケーションをビルドする場合，プロジェクトの``ArrayExcludedComponentName``キーが無視されました。特定のコンポーネントを除外するよう指定しても，4D Serverにプリインストールされているコンポーネントは，常にインストールされました。

* ACI0100536 Write ProドキュメントをMIMEエクスポートしてメール送信した場合，フォントサイズ``12``が``11``よりも小さく表示されました。

**注記**: Write Proのデフォルトフォントサイズが``12``であるため，エクスポート時に省略されていたことが原因でした。メールクライアントのデフォルトフォントサイズが``12``であるとは限りません。``WP EXPORT DOCUMENT``および``WP EXPORT VARIABLE``のHTMLおよびMIMEエクスポートが修正されました。

* ACI0100535 ビルド版のクライアント/サーバーアプリケーションは，コマンドラインパラメーターの``--user-param``で渡した値を``Get database parameter``と``User param value``で受け取ることができませんでした。

* ACI0100524 共有コレクションに対して``collection.clear()``を実行した場合，内部的に``Use`` ``End use`` のロック機構が使用されませんでした。そのため，別のプロセスがロックしているコレクションがクリアできてしまいました。

* ACI0100453 4D View Proドキュメントを``VP Convert to picture``でSVGに変換した場合，セルの高さと幅が正しくありませんでした。

* ACI0100451 Windows版のみ。リストボックスの列に対して``OBJECT GET BEST SIZE``を使用した場合に返される幅がv14とv18では違いました。リストボックスヘッダーのセパレーターをダブルクリックすることでも現象を確認することができます。

**注記**: GDIレンダリングモードのリストボックスで問題が起こります。DirectWriteモードでは問題ありません。v14以前に作成されたリストボックスは旧式のGDIレンダリングモードで描画されます。データベースパラメーター``107``に``2``を渡すことにより，強制的に旧式のレンダリングモードを有効にすることができます。レンダリングモードが違うため，値が同じでないこと自体はバグではありませんが，テキストが切れてしまうのは不具合でした。

* ACI0100420 プロジェクトモードのみ。インポート＆エクスポートダイアログの「フォーム」タブをクリックすると，アプリケーションがクラッシュしました。コマンドでインポートまたはエクスポートを実行した場合は問題ありません。フォームのプレビュー表示に問題があるようです。

* ACI0100403 Write Proのヘッダーがフォーカスされた状態でドキュメントを印刷した場合，ヘッダーにフォーカスが戻りませんでした。別のアプリケーションに切り替えてから戻れば，再びヘッダーがフォーカスできるようになります。

* ACI0099780 コンポーネントで作成したセマフォをクリアせずにプロセスを終了した場合，コンポーネントで作成したセマフォがクリアされませんでした。ホストで作成したセマフォは問題ありません。

* ACI0100683 フォーマットを指定せずに日付を4D View Proドキュメントに挿入した場合，カレントのロケールではなく，米国式（``mm/dd/yyyy``）が採用されました。

* ACI0100505 Mac版のみ。4D for iOSの公開テーブルからＮ対１リレーションが設定されており，クエリフィルターが有効にされている場合，モバイルアプリ側には，フィルターで除外されるレコードの代わりに空の行が表示されました。Ｎ対１リレーションが設定されていなければ，問題ありません。

* ACI0100103 Comodo社が発行した証明書（cert.pemおよびkey.pem）でHTTPSを使用することができませんでした。

**注記**: ファイルが``-----BEGIN CERTIFICATE-----``ではなく``-----BEGINCERTIFICATE-----``（スペース無し）で括られていることが原因でした。修正により，このような証明書は内部的に補正されるようになりました。

* ACI0100563 プロジェクトモードのみ。SQLコマンドの``DROP SCHEMA``でスキーマをドロップすることができませんでした。エラー``-1838 (SQLS)``が返されました。

* ACI0100624	 4D WriteドキュメントをWrite Proに変換した場合，表組（4D Writeでは，タブで表現される）のレイアウトが崩れることがありました。サイズが``cm``から``pt``に変換される過程で誤差が発生するようです。たとえば，``26.7cm``は``756.8504pt``ですが，変換されたドキュメントではタブの位置が``758pt``になるため，横向きのA4用紙の幅に収まらず，Write Proでは余分な改行が発生します。

**注記**: ``4W7``ドキュメントを変換する際には，``pt``または``twip``（20分の1ポイント）から``cm``または``mm``の変換が再計算されています。プラグインは，ミリメートルで値を丸めるようになっていますが，``twip``の処理に間違いがあったためです。修正前の変換は，タブ位置の絶対オフセット値にこの再計算が適用されていませんでした（デフォルトのタブオフセットは問題ありません）。修正により，タブ位置の絶対オフセット値も正確に変換されるようになりました。副作用として，修正前に変換されたドキュメントは，タブ位置が若干（``1mm``以内）違うことがあります。

* ACI0100686 Mac版のみ。4D for iOSで公開したテーブルに対し，「データ」セクションでフィルターを記述エリアに``command``+``A``を入力してからフィールドを選択した場合，アプリケーションがクラッシしました。

**注記**: オブジェクトの存在しないプロパティが``Substring``に渡されていたことが原因です。4D for iOSではなく，``Substring``のほうが修正されました。

* ACI0100685 Mac版のみ。プラットフォームにXcodeがインストールされていない場合，4D for iOSを起動すると「{app} をインストールしますか」という不完全なメッセージが表示されました。

* ACI0100317 Mac版のみ。``MESSAGE``コマンドで出力したテキストがウィンドウの高さに収まらなくなった場合，文字列の表示が崩れました。オーバーレイのビットマップはウィンドウのスケールファクター（解像度）を計算に入れていますが，（論理座標を使用する）描画APIにその情報が渡されていないようです。

* ACI0100684 ``SMTP New transporter``で送信したメールの``Message-ID``ヘッダーフィールドは，``RFC 2822``に準拠していないため，SpamAssassinなどのスパムフィルターにより，迷惑メールと判定されることがありました。RFCによれば，メッセージの識別子は一意でなければならず，そのために``@``をはさんで左側に識別子，右側にドメイン名を含めることが勧められています。4Dは，UUIDを使用しているため，一意の識別子ではありますが，ドメイン名がありませんでした。

* ACI0100673 4D Write Proドキュメント内の表組をリサイズした場合，アプリケーションがクラッシュしました。

**注記**: リサイズ操作中に大量の「取り消し/やり直し」が発生し，メモリを余分に消費していた問題が修正されました。修正により，おおきな表組の取り消しとやり直しの速度が改善されました。また，テーブルの幅が最小まで縮小された場合，自動ページブレークと罫線の再計算でクラッシュする件も修正されました。

* ACI0100542 Windows版のみ。リストボックスのセルが編集されている最中に，リストボックスの列を非表示にするなど，オブジェクトの構造を変更した場合，アプリケーションがクラッシュしました。

* ACI0100693 ``Get system info``から返されるオブジェクトの``uptime``プロパティは，``MAXLONG/512`` （``4194304``）の倍数に達するたびにリセットされて``0``に戻りました。つまり，``Tickcount/60 ``がそのまま返されています。コンピューターの稼働時間を約``49``日までしか計測することができません。

**注記**: ``Tickcount``は，ティック数を``32``ビットで返します。修正により，``uptime``プロパティは別の手段でコンピューターの稼働時間を返すようになりました。一般的に，Windowsでは``GetTickCount64``，Macでは``sysctl``と``CTL_KERN`` ``KERN_BOOTTIME``，Linuxでは``clock_gettime``と``CLOCK_MONOTONIC`` ``timespec``が使用できます。

* ACI0100692 トランザクション中にORDAで保存されたエンティティを削除しようとした場合，「スタンプが変更された」という理由で削除ができませんでした。従来の``START TRANSACTION``とORDAの``ds.startTransaction()``，どちらの方法でトランザクションを開始しても，問題が発生します。

* ACI0100679 プロジェクトモードでは，メソッドのプロパティを一括変更することができませんでした。ダイアログは表示されますが，変更した内容が反映されませんでした。

* ACI0100674 リストボックスの列に空の選択リストが設定されている場合，セルの編集中に矢印キーの「下」を入力すると，アプリケーションがクラッシュしました。リストが空ではなければ，ポップアップメニューが表示され，矢印キーで項目を選択することができます。

* ACI0100584 XLIFFを使用した選択リストがリストボックスに正しく表示されませんでした。

**注記**: リストボックスのプロパティリストが少しわかりづらかったかもしれません。ポップアップメニューなど，選択リストをサポートしているフォームオブジェクトには「関連付け」というプロパティがあり，デフォルトの設定は「リスト項目の値」となっています。しかし，このプロパティは，オブジェクトに選択リストを割り当てなければ，表示されません。リストボックスの列にXLIFFリストをポップアップメニューとして表示させたい場合，関連付けを「リスト項目の参照番号」に設定し，「指定リスト」も使用してください。

<i class="fa fa-external-link" aria-hidden="true"></i> [リストボックス列特有のプロパティ](https://doc.4d.com/4Dv18/4D/18/List-box-column-specific-properties.300-4575638.ja.html)

* ACI0100526 プロジェクトモードで``IMPORT TEXT``を実行した場合，何もデータがインポートされませんでした。``IMPORT SYLK`` ``IMPORT DIF``も同じ問題を抱えています。

**注記**: どのコマンドも内部的に「フォームを使用したインポート」を実行しています。

* ACI0097511 ``ORDER BY FORMULA``にピクチャ型の変数を渡した場合，アプリケーションがクラッシュしました。

* ACI0100702 4D WriteプラグインをWrite Proに変換した場合，スタイルシート名のアクセント文字（``Ä`` ``Ö`` ``Ü`` ``ß``）およびアンダースコア記号（``_``）が失われました。

**注記**: 修正により，アクセント記号は引き継がれるようになりましたが，アンダースコア記号は，スタイルシート名に含まれるホワイトスペース記号をHTML準拠の文字列にするために必要なプレースホルダーなので，アンダースコア記号が含まれるスタイルシート名をコマンドなどで参照した場合，スペースに変換された文字列が返されます。

* ACI0100707 4D WriteドキュメントをWrite Proに変換した場合，特定の数式が変換されずに失われました。

**注記**: リテラル文字列内でダブルクオート記号（``"``）がバックスラッシュ記号（``\``）でエスケープされているような数式で問題が発生しました。

* ACI0100347 Write Proのパレットウィジェットを使用してフォントサイズを``0``に設定した場合，エラーが返されました。
