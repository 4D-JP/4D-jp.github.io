---
layout: post
title: "4D Write Proに埋め込まれたQUERY"
date: 2019-01-13 19:45:23
categories: 仕様 
tags: writepro
version: 17.x 17r4
---

4D Writeドキュメントには，フィールド・変数・メソッド・関数などのフォーミュラを挿入することができます。想定されているのは，カレントセレクションから差し込み文書を出力したり，日付や時刻などの文字列を動的に挿入することでしたが，文書に``QUERY``を埋め込むことにより，ドキュメントの表示や印刷と同時にクエリが実行されるようにする，といった用途にも利用することができました。しかし，そのようなドキュメントを4D Write Proに変換した場合，フォーミュラが埋め込まれた箇所に「未定義」という文字列が表示されます。

4D Write Proでは，セキュリティのルールが見直され，ドキュメントにコマンドを挿入できるコマンドや関数が限定されていますが，データベース設定で制限を解除すれば，これまでどおり``QUERY``も挿入することができます。

参考：[4D Write Pro ドキュメントに含める式の制限 ](https://doc.4d.com/4Dv17/4D/17/Filter-expressions-contained-in-a-4D-Write-Pro-document.300-3726276.ja.html)

``QUERY``は値を返す関数ではなく，コマンドなので，実行後，ドキュメントには「未定義」という文字列が挿入されます。仕様どおりの動作ではありますが，4D Writeからのスムーズな移行をサポートするため，値を返さないフォーミュラは空の文字列として評価される，という仕様に改定されました。
