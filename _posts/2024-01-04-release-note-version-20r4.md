---
layout: fix
title: "4D 20r4 修正リスト"
date: 2024-02-19 08:00:00
categories: 修正リスト
tags: 20r4
build: 100220
version: "20r4"
permalink: /2024/4/:slug/
---

**バージョン**: {{page.version}}  
**ビルド**: {{page.build}} 

* ACI0104586 Mac版のみ。システムのロケールがベルギーのオランダ語（`nl-be`）に設定されている場合，`String`のフォーマット文字列`dd/MM/yyyy`がエラーを返されました。

* ACI0104581 Windows版のみ。`100%`よりも高いスケールにディスプレイを設定した場合，タブコントロールがクリック操作に反応しませんでした。

**注記**: 高解像度ディスプレイを正しくサポートするためには，互換性オプション「フォームでのテキストレンダリングではDirectWrite を使用する」を有効にする必要があります。修正により，オプションが設定されていなくてもタブコントロールがクリックできるようになりましたが，その場合，テキストレンダリングのクオリティが低下することに留意してください。

* ACI0104579 プロジェクトモードのみ。ブール型フィールドに対して`OBJECT DUPLICATE`を実行した場合，何も起きませんでした。

**注記**: プロジェクトモードにブール型フィールドというフォームオブジェクトは存在しません。ブール型フィールドをデータソースとするラジオボタンまたはチェックボックスがあるだけです。

* ACI0104562 メソッドエディターのコンテキストメニューでローカル変数の名称を変更した場合，複数行にわたって記述されたコードに看過されることがありました。

* ACI0104549 新ネットワークレイヤーで「ドメインサーバーによるユーザーの認証」を有効にした場合，メモリーリークが発生し，クライアントがフリーズすることがありました。ACI0103215が修正されたことによる副作用です。

* ACI0104529 Write Proエリアで行末にソフトブレークが存在する行に日本語のスタイル付きテキストをIMEで入力した場合，`1`行に`1`文字ずつ文字が表示されました。たとえば，メソッドエディターのリッチテキストをWrite Proエリアにペーストするとそのような行ができます。あるいは，*shift*+*return* に続けて*return* を入力することにより，ソフトブレークだけの空行ができるので，そこにIMEで日本語を入力しても再現します。

* ACI0104590 Mac版のみ。ラジオボタンまたはチェックボックスに対して`BEST OBJECT SIZE`を使用した場合，正しい値が返されないことがありました。オブジェクトの幅が数ピクセル不足しているため，ボタンタイトルが途切れて表示されます。フォームエディターの「自動サイズ」も同様です。

**注記**: Mac版のラジオボタンとチェックボックスには，Regular・Small・Miniというバリエーションがあり，オブジェクトの高さによって表示されるタイプが決まります。オブジェクトの最適サイズを計算するためには，表示されるラジオボタンまたはチェックボックスのサイズを特定する必要がありますが，タイトルのフォントではなく，オブジェクトの高さを判定基準にしていたために計算が合わないことがありました。仮にオブジェクトの高さが`10`ピクセル，タイトルのフォントの高さが`24`ピクセルだった場合，オブジェクトの高さを基準にすれば，タイプはMini（`11x11`）ですが，フォントを基準にすれば，タイプはSmall（`14x14`）になります。SmallであるべきところをMiniの幅で最適サイズを計算すると，タイトルを表示するエリアの幅が`3`ピクセル足りません。つまり，タイトルが完全に表示されるかどうかは，フォントの高さとオブジェクトの高さに左右されました。

* ACI0104553 ラジオボタンとして表示されるように設定されたブール型フィールドを配置したフォームをプロジェクトに変換した場合，ボタンタイトルが途切れて表示されることがありました。

* ACI0104530 Mac版のみ。自動アップデートを実行するための*Updater.app* がクラッシュしました。

* ACI0104231 *Web Folder* は存在しないものの，*qodlyApp.json* が存在する状態でWebサーバーを起動した場合，ランタイムエラーが返されました。

* ACI0103757 ピボットテーブルを含むView Proスプレッドシートを`.xlsx`形式でエクスポートしてExcelで開いた場合，ナビゲーションバーが表示されませんでした。オフスクリーンエリアで`VP EXPORT DOCUMENT`を使用した場合に問題が再現します。ユーザーインタフェースからエクスポートした場合は問題ありません。

* ACI0104574 `Open datastore`で*Qodly* からリモートデータストアに接続した場合，プロセス毎にセッションクッキーが発行され，クライアント接続ライセンスが消費されました。

* ACI0104558 フォームに２個の統合Webエリアを配置し，`WA SET PAGE CONTENT`で空のページを表示しようとした場合，アプリケーションがクラッシュしました。URLを`about:blank`に設定すれば問題ありません。いずれかのWebエリアをシステム版に変更すれば問題ありません。

* ACI0104515 `Open datastore`で4D Serverのユーザー名とパスワードを使用することができませんでした。*On REST Authentication* データベースメソッドで受信したパスワードハッシュを検証することができません。

**注記**: [4D 19 R3以降，*directory.json* の仕様が変わり，bcryptハッシュが使用されるようになった](https://blog.4d.com/ja/bcrypt-support-for-passwords/)ことが関係しています。修正により，`Open datastore`の接続パラメーターで`passwordAlgorithm`プロパティが設定できるようになりました。`4d-rest-digest`を指定すれば，以前と同じようにMD5系のハッシュが送信され，[*On REST Authentication*](https://doc.4d.com/4Dv20/4D/20.2/On-REST-Authentication-database-method.301-6720994.ja.html) データベースメソッドで[Validate password](https://doc.4d.com/4Dv20/4D/20.2/Validate-password.301-6721229.ja.html)を使用できるようになります。このプロパティは*On REST Authentication* でパスワードを検証するためのものです。RESTでサーバーにアクセスできるユーザー＆グループをストラクチャ設定で管理する場合，*On REST Authentication* は作成せず，`passwordAlgorithm`プロパティも省略してください。

<i class="fa fa-external-link" aria-hidden="true"></i> [ストラクチャー設定を使用する](https://developer.4d.com/docs/ja/REST/configuration#ストラクチャー設定を使用する)

* ACI0104341 ORDAの`entity.clone()`を実行した場合，エンティティがロックされました。

* ACI0104572 *Write Pro Toolbar* の印刷設定ボタンのヘルプTipsにXLIFF参照がそのまま表示されました。

* ACI0104550 `MIME-Version`や`Date`など，既定のヘッダーをメールオブジェクトで設定して`SMTP New transporter`で送信した場合，両方のヘッダーがMIMEに含まれました。一部のメールクライアントはヘッダーの重複に対応していないため，表示に問題がありました。いずれにしても，カスタムヘッダー値だけが送信されるべきです。

* ACI0104537 デザインモードで未使用のローカル変数を検索した場合，宣言と同時に初期化をしている行（したがって未使用ではない）がヒットしました。

* ACI0104533 *Client Web Application Expansion* ライセンスがインストールされていないクライアントで*NetKit* を使用することができませんでした。4D 20 LTSでは問題ありません。

* ACI0104511 エンティティを返すメンバー関数の呼び出しに続けてオブジェクト記法で属性パスを記述した場合，シンタックスチェックでエラーが返されました。エンティティを一旦ローカル変数に代入すれば問題ありません。

* ACI0104267 インタープリターモードのみ。`SET DATABASE PARAMETER`の*Max concurrent Web processes* などのオプションを設定した場合，インタープリターモードであってもWebプロセスがプリエンプティブスレッドで実行されるようになりました。Webサーバーを再起動すれば元の動作に戻ります。`WEB SET OPTION`またはデータベース設定でオプションを設定すれば問題ありません。

* ACI0104545 不正なコンパイル指示コメント（`//%W-550.100`）をメソッドに記述した場合，コンパイラー/シンタックスチェックがクラッシュしました。

* ACI0104539 Windows版のみ。Plugin APIの`PA_GetMainWindowsHWND`をプリエンプティブスレッドから実行した場合，アプリケーションがクラッシュすることがありました。

**注記**: 修正により，クラッシュは回避されるようになりましたが，プリエンプティブスレッドから当該APIを使用してはいけないことには変わりません。

* ACI0104528 Windows版のみ。統合Webエリアが配置されたフォームを最前面に移動するためには，ウィンドウのタイトルバーを`2`回クリックする必要がありました。

* ACI0104525 何らかの理由でリストボックスのヘッダーまたはフッターのオブジェクト名が空に設定されている場合，`METHOD GET PATHS`を実行するとアプリケーションがクラッシュしました。

* ACI0104463 リストボックスセルのスタイル付きテキストの先頭文字を選択し，コンテキストメニューからスタイルを適用した後，*command*+`A`でテキスト全体を選択した場合，スタイルがテキスト全体に適用されました。

* ACI0104427 4Dが最小化された状態でモーダルダイアログを表示した場合，ウィンドウがオフスクリーンに表示されました。

* ACI0104521*webAdmin* 権限がなくてもREST APIの`/rest/$call/method`をPOSTで呼び出すことができました。

* ACI0104483 Windows版のみ。配列型リストボックスの列に設定された関連リストのポップアップメニューがフォームウィンドウの外に表示された場合，選択したメニュー項目の値が正しく代入されませんでした。

* ACI0104543 期限を過ぎたライセンスが存在する場合，ライセンスマネージャーの更新ボタンがクリックできませんでした。

* ACI0104311 設定画面のメソッドページ（テーマ）のリストボックスにスクロールバーが表示されませんでした。

* ACI0104531 コンパイラーメソッドに`//%W-550.10`とコメントを記述しても，「変数を再定義しています」という警告をアプリケーション全体で無視することができませんでした。個別のメソッドにコメントを記述する必要があります。

* ACI0103777 Windows版のみ。View ProスプレッドシートをPDFまたはXPSプリンターで出力しようとした場合，システムエラーが表示され，アプリケーションがクラッシュしました。ACI0103757が修正されたことによる副作用のようです。

* ACI0104501 Windows版のみ。Microsoft Excelから4D ODBC DriverのDNSにアクセスすることができませんでした。

* ACI0104480 ドイツ語版のみ。設定画面のドキュメントURLが正しくありませんでした。ドイツ語のドキュメントは公開されていないので，英語版と同じ *https://developer.4d.com/docs/Preferences/overview* を開くべきです。

* ACI0104523 `&&`または`||`演算子で結合したリレーション属性のクエリ条件が評価されませんでした。v20.1では問題ありません。

* ACI0104520 4D View Proのフォーミュラエディターパネルが正しく動作しませんでした。

* ACI0104516 *shift* キーを押しながらサーバー管理画面（プロセスページ）のスプリッターを縦に移動した場合，内部エラーが返されました。

* ACI0104513 「自動行高」プロパティが有効にされているエンティティセレクション型のリストボックスに表示されているエンティティセレクションを変更した場合，正しい高さで行が表示されませんでした。ウィンドウをリサイズすると，正しい高さで行が再描画されます。

* ACI0104503 *WebAdmin* のポートからリクエストを受信した場合でも*On REST Authentication* データベースメソッドが実行されました。

**注記**: 修正により，ホストではなくコンポーネントの*On REST Authentication* データベースメソッドが実行されるようになりました。

* ACI0104452 クイックレポートのフィールドタイトルを編集中に*escape* キーを入力した場合，エラー`9850`が返されました。

**注記**: リストボックスのセル入力確定前にフォームをアンロードした場合のイベントサイクルに問題がありました。入力エリアでは問題ありません。

* ACI0103597 ドイツ語版またはスペイン語版では`VP REMOVE COLUMNS`が正しく動作しませんでした。

**注記**: SpreadJS 16.2.0で問題が修正されました。

* ACI0103977 自動セッション管理を無効にした場合，RESTアクセスのたびにエラースタックがおおきくなりました。

* ACI0104402 `4D.HTTPRequest`にオブジェクト型のメモリーリークがありました。

* ACI0104478 Intelコンパイルモードのみ。BLOBのインデックス添字にBlob sizeぴったり（つまり`1`バイトオーバー）の位置を渡した場合，範囲チェックが働きませんでした。バッファーオーバーフローにより，アプリケーションがクラッシュする恐れがあります。ARMコンパイラーでは問題ありません。

* ACI0104472 メンテナンス＆セキュリティセンターのアクティビティログの日付フォーマットが正しくありませんでした。`2023-12-21`と出力されるべきところが`12--0021`のように出力されます。

* ACI0104446 Mac版のみ。共有フォルダー内のファイルやフォルダーに対し，`File.rename()`や`Folder.rename()`を使用した場合，「Operation not supported」というPOSIXエラーが返されました。ターミナルで`mv`コマンドを使用すればリネームできるので，アクセス権限の問題ではありません。

**注記**: 4Dは内部的に`renamex_np`をコールしています。修正により，エラー`45`（option not supported by network share）が返された場合，`RENAME_EXLC`を[指定せずに](https://developer.apple.com/documentation/foundation/nsurlvolumesupportsexclusiverenamingkey)リネームを再試行するようになりました。

* ACI0104510 データファイルのサイズ増加に伴い，レコードの保存に要する時間が長くなりました。たとえば`0`GBのデータファイルであれば`10`秒間に約`110,000`件のレコードが作成できるのに対し，`100`GBでは約`42,000`件，`1100`GB（`1.1`TB）では約`6,000`件のレコードしか作成できませんでした。

* ACI0104497 外部プロジェクトに公開オプションの「Webサービス」が有効にされたメソッドが存在する場合，`Compile project`がエラーを返しました。

* ACI0104462 * /RESOURCES/en.lproj* に *syntaxEN.json* が存在する場合，「コンパイル時にコード補完用のシンタックスファイルを生成する」を無効にして再コンパイルしてもファイルが削除されませんでした。

* ACI0104444 `var`シンタックスで複数の変数名と序数引数をまとめて宣言している場合，ローカル変数の再宣言に関するシンタックスチェックの警告メッセージに間違った変数名またはパラメーター名が表示されました。

* ACI0104435 フィールド属性の「必須入力」はプロジェクトモードで廃止されており，ストラクチャエディターのプロパティリストからも項目が削除されていますが，ストラクチャをプロジェクトに変換した場合，`.4DCatalog* ファイルには`mandatory`属性が残され，変換ログにも警告やエラーが出力されませんでした。変換後，当該フィールドを未入力のまま保存するとデータベースエラーが返されます。

**注記**: 修正により，変換ログに下記のエラーが出力されるようになりました。

> "No longer supported 'mandatory' attribute in project found on field '<Field name>' of table '<Table name>'. Please use instead 'Reject NULL value input' (or 'Map NULL values to blank values')"

* ACI0104415 Windows版のみ。複数のモニターが接続されている環境で最大化されたSDIモードのウィンドウを最小化し，タスクバーのアイコンをクリックして復元した場合，元のディスプレイにウィンドウが表示されませんでした。

* ACI0104506 ベベルスタイルのボタンのポップアップメニューをリンクに設定した場合，*.4DForm* ファイルにはフォームイベントの *On Alternate Click* に相当するプロパティが追加されますが，フォームエディターのプロパティリストにはイベント名が表示されませんでした。

* ACI0104499 QUICネットワークレイヤーのみ。ビルド版のクライアントからサーバーに接続しようとした場合，ストラクチャを開くことができない，というエラーが表示されることがありました。特定の変数が正しく初期されていないことが関係しています。

* ACI0104487 *raw* フォーマットのアイテムが`1`個だけ存在する場合，`NetKit.GoogleMailIdList.getMailIds()`が`null`を返しました。*minimal* フォーマットでは問題ありません。

* ACI0104468 ピクチャポップアップメニューのデータソースに`Form`を使用することができませんでした。

* ACI0104433 *.docx* 形式または*.pdf* 形式でWrite Proドキュメントをエクスポートした場合，ソフトハイフンが標準のハイフンに変換されました。

* ACI0104504 メンテナンス＆セキュリティセンター，ツールバー，ライセンス更新などのダイアログのアイコンのタイトルが途切れて表示されました。

* ACI0104490 データクラスに計算属性が存在する場合，フォームエディターのリストボックスビルダーがエラーを返しました。

* ACI0104486 Mac版プロジェクトモードのみ。ツールボックスのヘルプTipsのテキストエリアがダークモードに対応していませんでした。白色の文字が明るい黄色の背景色に表示されます。

* ACI0104485 */$lib/studio* にアクセスしても，*WEBJS/studio* のファイルが返されませんでした。REST APIをコールした後であれば問題ありません。

* ACI0104450 Write Proインタフェースのドロップダウンメニューでフォントを選択した場合，ポップアップの選択項目が変更前のフォント名に戻りました。

* ACI0104445 Mac版のみ。アプリケーションビルドキーの*ServerEmbedsProjectDirectoryFile* を使用した場合，*directory.json* ファイルが非表示ファイルとしてコピーされました。

* ACI0103660 `IMPORT DATA`で読み込みダイアログを開いた場合，テーブルを選択することができませんでした。ファイルメニューからダイアログを起動した場合は問題ありません。

* ACI0104203 プロジェクトモードのみ。ボタンがフォーカスされた状態で`WA OPEN WEB INSPECTOR`を実行した場合，アプリケーションがクラッシュしました。Webエリアがフォーカスされていれば問題ありません。

* ACI0104401 Write Proドキュメントの末尾に段落あるいは行以外のブレークを削除することができませんでした。

* ACI0104386 アプリケーションをビルドした場合，QodlyのWebフォームが表示されませんでした。`PackProject`を`True`に設定し，プロジェクトフォルダーを*.4DZ* 形式に圧縮しなければ問題ありません。

* ACI0104216 `VP IMPORT FROM OBJECT`を実行した場合，メモリーリークが発生しました。*CefProcessHandler* が`15`GBを超えるRAMを占有することがあります。

**注記**: SpreadJS 16.0.xの問題でした。問題は16.2.4で修正されています。

* ACI0104471 `TEXT TO BLOB`に空の文字列を渡した場合，結果が正しくありませんでした。`1`バイトのデータが返されました。
