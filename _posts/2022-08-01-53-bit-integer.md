---
layout: post
title: "53ビット整数"
date: 2022-08-01 08:00:00
categories: 仕様
tags: 19r6 programming
---

4Dのコンパイラーは，`64`ビット整数をサポートしていません。SQLはコンパイルの対象外であるため，例外的に`64`ビット整数型フィールドが扱えます。`64`ビット整数型のコンパイルをサポートするためには，コンパイラーの全面的な書き換えが必要となり，これには２ないし５年の歳月がかかると想定されています。現時点で`64`ビット整数型のサポートは計画されていません。

[バリアント型](https://developer.4d.com/docs/ja/Concepts/variant.html)や[オブジェクト型](https://developer.4d.com/docs/ja/Concepts/object.html)は，マクロ（プリプロセッサ）によって展開される擬似的なデータ型なので，コンパイラーを全面的に書き換えることなく，比較的短期間でランゲージに追加することができました。オブジェクト記法も同様です。

PostgreSQLなど，`64`ビット整数型のプライマリーキーを使用するような外部システムと連携する場合，`32`ビット整数型のフィールドでは同期ができない，という問題に直面します。プライマリーキーは，基本的にシーケンス番号であり，実際に`64`ビット整数の最大値（符号付きで`9,223,372,036,854,775,807`=922京3372兆368億5477万5807）まで使用することはないとはいえ，`32`ビット整数の最大値（`2,147,483,647`=21億4748万3647）では足りなくなる恐れがあります。

そのようなわけで，19r6では，実数型を`53`ビット整数として使用できるようになりました。

<i class="fa fa-external-link" aria-hidden="true"></i> [Support of larger integers than integer32](https://blog.4d.com/enhanced-conversion-real-to-text/)

4Dの[実数型](https://developer.4d.com/docs/ja/Concepts/number.html)は[IEEE 754](https://ja.wikipedia.org/wiki/IEEE_754)準拠の[倍精度浮動小数点数](https://ja.wikipedia.org/wiki/%E5%80%8D%E7%B2%BE%E5%BA%A6%E6%B5%AE%E5%8B%95%E5%B0%8F%E6%95%B0%E7%82%B9%E6%95%B0)であり，符号`1`・仮数`52`・指数`11`の`64`ビット（`8`バイト）で成り立っています。`53`ビットあれば，[MAX_SAFE_INTEGER](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER)つまり`9,007,199,254,740,991`=9007兆1992億5474万991まで正確に整数を表現することができます。

これまでのバージョンでは，おおきな実数を文字列に変換すると`12`桁の指数表現になり，整数であれば精度が失われました。19r6では，`17`桁以内の整数を収めた実数は，整数のまま文字列が変換されるように仕様が見直されています。JSON・XMLドキュメントの実数⇆文字列変換も整数であれば整数のまま出力されるようになりました。メソッドエディターの数値リテラルも`17`桁以内の整数は指数表現でトークナイズされないようになりました。
