---
layout: fix
title: "ローカルプロセスの廃止"
date: 2025-10-28 08:00:00
categories: 仕様
tags: process programming 
---

v21では，プロセス名が`$`記号から始まる場合，ローカルプロセスと呼ばれる特殊な振る舞いをする仕組みが廃止されました。これは仕様の変更です。

<i class="fa fa-external-link" aria-hidden="true"></i> [リリースノート](https://developer.4d.com/docs/ja/Notes/updates)

v12以前のバージョンでは，[ローカルおよびグローバルプロセス](https://library.4d-japan.com/doc/4Dv12/4D/12.4/Processes.300-977765.ja.html)の間に明確な区別がありました。

> ローカルプロセスは、データアクセスを必要としない処理の場合にだけ使用することをお勧めします。例えば、イベント処理メソッドを実行、またはフローティングウィンドウ等のインタフェース要素を制御するためにローカルプロセスを使用します。
> 
> 名前によってプロセスがローカルであることを指定します。ローカルプロセス名は、先頭にドル記号 ($) を付ける必要があります。

グローバルプロセスには，クライアント側のカレントレコード・[命名セレクション](https://library.4d-japan.com/doc/4Dv12/4D/12.4/Named-Selections.300-977908.ja.html)・[セット](https://library.4d-japan.com/doc/4Dv12/4D/12.4/Sets.300-977527.ja.html)・[トランザクション](https://library.4d-japan.com/doc/4Dv12/4D/12.4/Using-Transactions.300-977360.ja.html)をサーバー側のトリガプロセス（「[サーバー上で実行](https://library.4d-japan.com/doc/4Dv12/4D%20Server/12/Execute-on-Server-attribute.300-67455.ja.html)」メソッドを実行するプロセス）と同期する仕組みがあります。また，データベースにアクセスすることができます。

> 4D Server: データアクセスを行わない処理に対し、クライアント側でローカルプロセスを使用すると、サーバの負荷が軽減されます。

当時のドキュメントで言及されているように，プロセスからレコードにアクセスする必要がない場合，グローバルプロセスの代わりにローカルプロセスを起動することで，ネットワーク通信とサーバーリソースの最適化を図ることができました。

ローカルプロセスは，直接データベースにアクセスすることができません。そこでアプリケーションプロセス（プロセス番号`1`）のデータベースコンテキストを「借りて」サーバーと通信する仕組みが用意されていました。便利な仕組みではありますが，危険なことでもありました。

> 警告: ローカルプロセスでデータアクセスを行った場合、メインプロセスでアクセスすることになり、そのプロセス内で実行される処理との間でコンフリクトが起きるおそれがあります。

ドキュメントの警告を無視し，アプリケーションプロセスとローカルプロセスの両方からデータベースにアクセスすると，サーバーがクラッシュする恐れがあります。こうした問題を避けるため，v21ではプロセス名が`$`記号から始まるローカルプロセスの概念そのものが廃止されました。

v13以降，グローバルプロセスは，クライアント側で起動し，初回のレコードアクセスでデータベースコンテキストが作成されるように改良されています。つまり，ローカルプロセスからグローバルプロセスに「昇格」します。言い換えるなら，データベースにアクセスしない限り，グローバルプロセスは従来のローカルプロセスと何も変わりません。誤ってアプリケーションプロセスとローカルプロセスの両方からデータベースにアクセスするリスクを抱えることなく，安全にネットワーク通信とサーバーリソースの最適化を図ることができます。