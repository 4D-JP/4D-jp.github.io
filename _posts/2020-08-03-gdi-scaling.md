---
layout: post
title: "GDIスケーリング論考"
date: 2020-08-33 12:00:00
categories: 仕様
tags: 18.x windows graphics
---

Windowsには，**GDI**ベースのアプリケーションが高解像度ディスプレイでも鮮明に表示されるようにするための**表示スケール**という仕組みがあります。GDIは，Windowsネイティブアプリで2Dグラフィックを描画するための標準的なAPIのひとつで，高解像度ディスプレイ以前から存在し，テキスト・アイコン・図形・画像といった2Dグラフィックを**常に96 DPI**で描画するように設計されています。GDIで描画した画面が高解像度ディスプレイで縮小されないようにするためには，実際のDPIに合わせて画像を拡大する必要があります。**画面がぼやけて表示されるのはそのためです**。

Creators Update（Windows 10 1703）では，この現象を改善するため，**GDIスケーリング**という仕組みが導入されました。**アプリの表示スケールの修正**で表示がぼやける可能性があるといわれている**一部のデスクトップアプリ**は，GDIで画面を描画しているアプリのことを指しています。4Dは，GDIとDirect2D（高解像度ディスプレイに対応したAPI）を併用しているので，これに該当します。

<img width="490" alt="scale" src="https://user-images.githubusercontent.com/10509075/89237492-46082500-d62e-11ea-8589-90e8914399c5.png">

高解像度ディスプレイ（4Kなど）を搭載したノートパソコンに標準的な外部モニター（1080pなど）を接続し，デスクトップを拡大しているユーザーは少なくありません。その場合，ノートパソコンは解像度を200%（192 DPI）に設定し，外部モニターは100%（96 DPI）のまま使用する，といったことができます。従来のスケーリングでは，物理的なサイズを再現するため，画面の解像度に合わせて画像を引き伸ばしていました。そのように拡大された画像は，**96 DPIのデータしか持ち合わせていない**ため，おおきなピクセルで表示されたり，ぼやけて表示されたりします。

ディスプレイ毎のDPIを考慮し，場面に合わせて動的に画像データを差し替えるようにアプリが設計されていれば良いのですが，高解像度ディスプレイ以前から存在するGDIアプリは，そのような仕組みを持っていません。GDIスケーリングは，アプリの代わりに**システム**がスケーリングするので，DPIを意識したプログラミングをしなくても良い，というメリットがあります。特に**テキスト**がぼやけてよみづらいという問題が改善されることが期待できます。
