---
layout: fix
title: "4D v20r2 修正リスト"
date: 2023-08-22 08:00:00
categories: 修正リスト
tags: 20r2
build: 100250
version: "20r2"
permalink: /2023/178/:slug/
---

**バージョン**: {{page.version}}  
**ビルド**: {{page.build}} 

* ACI0104114 バイナリモードのみ。ピクチャライブラリのヘッダーをクリックしても，IDまたは名前で画像が並び替えられませんでした。

* ACI0104100 Mac版バイナリモードのみ。ピクチャライブラリの画像に４桁以上のIDが設定されている場合，IDの表示がエリプシスで省略されました。

* ACI0104021 *On Row Moved* イベントおよびシングルクリック編集が有効にされた配列型リストボックスの行を移動した場合，*On Clicked* イベントが発生しました。ACI0103898と類似した不具合です。

* ACI0103754 Mac日本語版のみ。コンボボックスにアプリケーションフォントを設定した場合，メニュー項目の高さが足りませんでした。アプリケーションフォントは内部的に *Helvetica* または *San Francisco* のような欧米フォントですが，日本語システムでは代替フォントが使用されます。通常のテキスト入力は自動的に高さが調整されますが，コンボボックスのメニュー項目は欧米フォントに基づいて高さが計算されているようです。

* ACI0102794 プラグインを必要とする外部プロジェクトを`Compile project`でコンパイルすることができませんでした。

* ACI0104109 複数の`OR`演算子を使用してリレーション計算属性をクエリした場合，正しい結果が返されませんでした。ACI0104049と類似した不具合です。

* ACI0103755 標準アクションの「次レコード」と同時に`GOTO OBJECT`でフォームオブジェクトからフォーカスを解除することができませんでした。

* ACI0101038 フォームに複数のブレークを設定した場合，フォームエディターのルーラーには上から順にB3, B2, B1, B0と表示されますが，プロパティリストにはフォームブレーク, フォームブレーク1, フォームブレーク2と番号が振られました。

* ACI0104119 Windows版のみ。グループボックスのタイトルテキストが完全に表示されないことがありました。フォント名・フォントサイズ・テキストの内容・外部モニターの使用などが関係しているようです。

* ACI0104131 同一フォームの通常スタイルのデフォルトボタンが配置されている場合，角の丸いボタンの背景色が通常ボタンと同じ色になりました。

* ACI0104124 プリント設定画面で終了ページを制限した場合，最終ページが正しく出力されませんでした。

* ACI0104116 3Dボタンのアイコンがやや右にずれて表示されました。

* ACI0104112 プラグインから返された値を`APPEND TO ARRAY`に渡した場合，アプリケーションがクラッシュする恐れがありました。

* ACI0104130 Windows版のみ。`mklink /d symlink`で作成したシンボリックリンクを使用して複数のクライアントアプリケーションを起動した場合，後に起動したクライアントでサーバーに接続すると，先に起動したクライアントのサーバー接続が解除されました。

* ACI0103184 配列型またはエンティティセレクション型リストボックスの選択されていない行に表示されているチェックボックスをクリックした場合，その行ではなく，最後に選択した行の値が更新されました。

* ACI0104084 `WP SET ATTRIBUTES`で値の単位を変更した場合，属性値が更新されませんでした。たとえば`20mm`を`2cm`に変更した場合，値が更新されませんでした。

* ACI0104120 Apple Siliconターゲットのみ。存在しないメソッドパラメーターにアクセスした場合，終了時にアプリケーションがクラッシュしました。

* ACI0104115 バイナリモードのみ。3Dボタンがローカライズされず，XLIFF識別子がそのまま表示されました。

* ACI0103999 Windows版プロジェクトモードのみ。ボタンスタイルが通常またはフラットに設定された3Dボタンにフォーカスを移動した場合，*Enter* キーを入力してもデフォルトボタンが反応しませんでした。

**注記**: プロジェクトモードでは3Dボタンにフォーカスを移動することができますが，ツールバー・Office XP・サークルボタン（Windows）にフォーカスを移動してもボタンの外観は変化しない点に留意してください。これは仕様です。フォーカスリングが表示されていなかったとしても，これらのボタンがフォーカスされている状態で *Enter* キーを入力した場合，デフォルトボタンが反応します。

* ACI0104106 バイナリモードのみ。クライアントで新規プロジェクトメソッドを作成し，トップレベル以外のフォルダーを指定した場合，デザインモードでエクスプローラーを開いていない他のクライアントがクラッシュしました。

* ACI0104105 `@`記号で区切られたテキストを`GET TEXT KEYWORDS`で単語に分解できませんでした。

**注記**: ICU 72.1の不具合でした。問題はICU 73.2で修正されています。ライブラリのアップデート前にインデックスを作成した場合，自動的にインデックスが再構築されます。

* ACI0104064 フランス語版のみ。ランゲージをフランス語に切り替えた場合，定数の *ck count values* がトークナイズされませんでした。

* ACI0104107 日付型フィールドに対するポインターを括弧で括らずに比較演算の右オペランドとして記述した場合，シンタックスエラーが返されました。

* ACI0104077 フォームのページ移動と同時にリストボックスの列を再作成し，`LISTBOX SET PROPERTY(*; …; lk auto row height; lk yes)`と`LISTBOX SET AUTO ROW HEIGHT`を実行した場合，アプリケーションがクラッシュしました。空のリストボックスに列を追加した場合，あるいはリストボックスの自動行高プロパティが最初から有効であれば，問題ありません。

* ACI0103947 Windows版のみ。進捗インジケーターのデータソース値が`0`の場合，わずかな幅のインジケーター値が表示されました。

* ACI0104104 `GET PRINTABLE AREA`から返される高さがv19と違いました。

**注記**: 問題は修正されましたが，印刷前に`SET PRINTABLE MARGIN (-1;-1;-1;-1)`を実行することで回避策することができます。

* ACI0104101 Mac版のみ。角の丸いベベルボタンのタイトルが描画されませんでした。

* ACI0104097 複数のプリエンプティブプロセスから同時に`Get monitored activity`を実行した場合，アプリケーションがクラッシュしました。

* ACI0104054 プロジェクトモードのみ。フォームエディターのコンテキストメニュー項目「自動サイズ」をラジオボタンまたはチェックボックスに対して使用した場合，サイズ計算が正しくありませんでした。

* ACI0104090 *Alt* （Mac版は *control* ）キーを押しながらコメント行に記述されたテーブル名またはフィールド名にマウスポインターを重ねた場合，トークンがハイパーリンクに変化せず，「定義に移動」コンテキストメニューも表示されませんでした。

* ACI0104055 Windows版のみ。実行ファイルのパスにスペース記号が含まれる場合，タスクマネージャーの詳細タブの「コマンドライン」にコマンドラインが完全に表示されませんでした。クラッシュダンプに出力されるコマンドラインもスペース記号で途切れます。

* ACI0103870 エクスプローラーに *constTheme_92 not found !!* のようにローカライズされていない定数グループ名が表示されました。

* ACI0104092 ユーザーモードのメニューからクイックレポートエディターを起動した場合，プリントプレビューが実行できませんでした。Macではプリンターにジョブが送信され，Windowsではファイル保存ダイアログが表示されます。コマンドでクイックレポートエディターを起動した場合は問題ありません。

* ACI0104075 Mac版のみ。チェックボックスのタイトルを`OBJECT SET TITLE`で変更した後に`OBJECT GET BEST SIZE`を実行した場合，幅に`0`が返されました。

* ACI0103989 Mac版プロジェクトモードのみ。テキストまたは入力オブジェクトの「横揃え（`textAlign`）」プロパティを「両端揃え（`justify`）」に設定した場合，ランタイムモードでは設定が無視され，「左（デフォルト）」横揃えになりました。

* ACI0104089 コンパイルモード版のみ。`Formula`から返されたリテラル表記のオブジェクトを使用した場合，エラーが返されました。

* ACI0104087 `False ? [1;2] : 3`のようにリテラル表記のコレクションを３項演算子の戻り値に使用した場合，シンタックスエラーが返されました。

* ACI0104079 Mac版のみ。エンティティ属性にマウスポインターを重ねた時に表示されるヘルプTipsに余計な空行が表示されました。

* ACI0104078 `SVG_Export_to_picture`などのコンポーネントメソッドにマウスポインターを重ねた時に表示されるヘルプTipsが正しく表示されませんでした。スタイル付きテキストのタグがそのまま表示されます。

* ACI0104074 メソッドエディターのタイプアヘッドで`entitySelection.length`が入力できませんでした。

* ACI0104072 Mac版のみ。ボタンをクリックしている間の背景色が正しくありませんでした。デフォルトボタン以外は背景色がアクセントカラーではなく，グレーで表示されるべきです。

* ACI0104071 Mac版のみ。角の丸いベベルチェックボックスのタイトルのフォントカラーに問題がありました。フォントカラーが自動に設定されている場合，タイトルはホワイトで表示されるべきです。

* ACI0104002 リテラル表記のオブジェクトをトークナイズした場合，プロパティ名とコロン記号（`:`）の間に入力された余計なスペースが取り除かれませんでした。
	
* ACI0103926 プロジェクトモードのみ。オブジェクト名シンタックスでボタンのタイトルをローカライズすることができませんでした。XLIFFシンタックスまたはSTR#シンタックスであれば問題ありません。また，ラジオボタンやチェックボックスなどのフォームオブジェクトでも問題ありません。

* ACI0104060 多数（`10`個）のプリエンプティブプロセスから大量（`100,000`個）JSONオブジェクトを同時に作成した場合，平行処理に期待されるパフォーマンス向上が得られませんでした。

**注記**: 共有オブジェクトである`4D.Object`クラスとは違い，`4D.Object`インスタンスは共有オブジェクトでありません。用途に応じ，`4D.Object`クラスのミューテックス活用を最小限にとどめることにより，パフォーマンスの最適化が図られました。

* ACI0104038 *VS Code* のLSPとして使用した場合，*tool4d* のCPU占有率がほぼ`100`%に達しました。

* ACI0103979 Apple Siliconターゲット向けにコンパイルされたMac版の4D ServerプロジェクトにWindows版の4D Remoteで接続した場合，クライアントがクラッシュしました。*On Startup* メソッドが存在しなければ問題ありません。

**注記**: Apple Siliconターゲット限定（Intelターゲット無し）のプロジェクトを検出する仕組みがありませんでした。修正により，内部的なマーカーおよび新しいエラーメッセージが追加されましたが，プロジェクトを再コンパイルする必要があります。

* ACI0104037 プロジェクトモードのみ。配列型リストボックスの未定義列に`SELECTION TO ARRAY`で文字列フィールドをコピーした場合，データソースが`ARRAY TEXT`ではなく，`_o_ARRAY STRING`になりました。

* ACI0103994 Mac版のみ。[iODBC Framework](https://www.iodbc.org/dataspace/doc/iodbc/wiki/iodbcWiki/WelcomeVisitors)がインストールされていない環境で`SQL LOGIN`を実行した場合，アプリケーションがクラッシュしました。

* ACI0103613 Mac版のみ。[Devart ODBC Driver for Sybase v.3.3.1](https://www.devart.com/odbc/ase/download.htm) を使用して`SQL LOGIN`を実行した場合，エラー`9921`が返されました。

**注記**: [Microsoftの仕様](https://learn.microsoft.com/en-us/sql/odbc/reference/syntax/sqlconnect-function?view=sql-server-ver16)に従い，4Dは`SQLConnectW`と`SQL_NTS`を使用しています。Apple Silicon版のDevart ODBC Driverはパスワードの処理で[`SQL_NTS(-3)`](https://github.com/microsoft/ODBC-Specification/blob/master/Windows/inc/sql.h)モードを正しく実装しておらず，*null-terminated string* がきちんと受け取れていません。Devart ODBC Driverのバグですが，文字数を渡すように4D側で回避することになりました。

* ACI0104076 4D Write Pro Interfaceコンポーネントを使用し，Write Proドキュメントにフォーミュラを挿入した場合，バイナリ形式でフォーミュラが挿入されました。そのようなドキュメントが保存されたフィールドを「レコードの強制更新」モードで圧縮した場合，フォーミュラが失われました。

**注記**: 通常，`WP INSERT FORMULA`で挿入したフォーミュラは文字列として保存されます。

```html
<span style="-d4-ref:'Current date:C33'"> </span>
```

しかし，4D Write Pro Interfaceコンポーネントで挿入したフォーミュラは特殊な形式で保存されます。

```html
<span style="-d4-ref-data:'data:application/octet-stream;base64,Bf3/YW1mNF4AAAAAAAAA6////zQARAAgAFcAcgBpAHQAZQBQAHIAbwAgAEkAbgB0AGUAcgBmAGEAYwBlACAAAAAAAAQAAAAAAEVWU1JPSQ0AAQAhAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=='"> </span>
```

MSCは4D Write Pro Interfaceコンポーネントをロードしていないため，このようなフィールドを「レコードの強制更新」モードで圧縮した場合，フォーミュラが評価できずに空の文字列となりました。修正により，MSC圧縮のようにデータベースが実行されていない場面では，レコードに保存されたWrite Proドキュメントを開こうとするのではなく，データストリームをそのままコピーするようになりました。

* ACI0104067 プラグインSDKのエントリーポイント`PA_ExecuteObjectMethod`を使用し，パラメーターを渡してコンパイルモードでエンティティセレクションのメンバー関数を実行しようとした場合，アプリケーションがクラッシュしました。

* ACI0104080 Windows版のみ。VS Code Extensionの[4D-Analyzer](https://marketplace.visualstudio.com/items?itemName=4D.4d-analyzer)で4Dまたは4D ServerをLSPにすることができませんでした。

* ACI0104059 後続のサブセクションと水平マージンが異なるサブセクションにテーブルを挿入した場合，同時にページブレークも挿入されました。

* ACI0103950 プロジェクトモードのみ。既存のフォームと名前が重複するフォームを作成しようとした場合，ランタイムエラーが返されました。

* ACI0104017 `$pTable:=->`にようにポインターの逆参照に続けてテーブル名をタイプアヘッドで入力した場合，ブラケット記号が省略されました。

* ACI0104061 Windows版のみ。Write ProドキュメントをPDF形式でエクスポートした場合，*Artdeco MN* フォントの文字が重ねて表示されました。Microsoft Print to PDFを使用すれば問題ありません。

**注記**: Write Proが内部的に使用している[PDF-Writer](https://github.com/galkahana/PDF-Writer)のローレベル処理（カーニング）に問題がありました。回避策として，*Artdeco MN* フォントファミリーは，DirectWriteのAPIでフォントのオフセット位置を計算するようになりました。

* ACI0104026 エクスプローラーのごみ箱にテーブルが残っている状態でごみ箱を空にした場合，アプリケーションがクラッシュしました。

* ACI0104058 Write Proドキュメントに新しく挿入したフォーミュラの表示を値に切り替えることができず，常に参照が表示されました。

* ACI0104030 `#DECLARE`構文または`C_POINTER`でポインター型のパラメーターを宣言し，渡されたポインター型のパラメーター自体に別のポインターを代入した場合，呼び出し元のポインターも更新されました。パラメーターはたとえポインター型であってもローカル変数と同じように振る舞うべきです。

* ACI0104001 サーバーを１週間以上運用した場合，[データ収集](https://developer.4d.com/docs/ja/Admin/data-collect/)の`uptime`が更新されませんでした。

* ACI0104031 クラスの`property`宣言でコンポーネントのクラスをデータ型として参照した場合，シンタックスチェックでオブジェクトは未定義のクラスであるという警告が返され，プロパティ入力のタイプアヘッドでもクラスのメンバー関数やプロパティが候補として列挙されませんでした。

* ACI0104049 `OR`または`IN`演算子を使用してリレーション計算属性をクエリした場合，正しい結果が返されませんでした。

* ACI0103972 クライアント/サーバー版のみ。インタープリター再起動・コンパイル済み再起動を素早く繰り返した場合，クライアントがデッドロック状態に陥ることがありました。

* ACI0104029 クラスのプロパティを *Integer* 型で宣言し，そのプロパティを`-This.prop`のように符号を反転して参照した場合，コンパイラーがエラーを返しました。

* ACI0104027 プロジェクトモードのみ。プロパティリストのフッターエリアにカレントタブ名が完全に表示されませんでした。エリアが正しくリサイズされていないようです。

* ACI0104036 Write Proインタフェースで継続したセクションのカラム数を変更した場合，ドキュメント全体のカラム数が変更されました。

* ACI0103928 `LDAP password MD5 (0)`モードで`LDAP LOGIN`と`LDAP LOGOUT`を繰り返した場合，予期しないエラー`-2`が返されました。ACI0103594が修正されたことによる副作用のようです。

* ACI0104039 プロジェクトモードのみ。スリーステートチェックボックスが正しく機能しませんでした。

* ACI0104007 自動行高が設定されている配列型リストボックスの最大あるいは最小行高を`LISTBOX SET AUTO ROW HEIGHT`で設定した場合，リストボックスの行高が新しい設定に沿って正しく再計算されませんでした。

* ACI0103748 フィールド属性の「ヌル値を空値にマップ」が有効にされていない場合，エンティティセレクション型リストボックスに表示された新規エンティティの属性に値を入力しても，セルからタブ移動すると入力した値がクリアされました。入力エリアの問題（ACI0103657）に似ています。

**注記**: リストボックスのデータソースからフィールドを特定できれば，`Null`の代わりにフィールドタイプに合った値を入力できるように修正されました。