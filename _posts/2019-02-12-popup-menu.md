---
layout: post
title: "ポップアップメニューのデータ型"
date: 2019-02-12 12:00:00
categories: 注意点
tags: 17.0 
version: 17.0
---

[ポップアップメニュー/ドロップダウンリスト](https://doc.4d.com/4Dv17/4D/17/Pop-up-MenusDrop-down-Lists.300-3743679.ja.html)は，いろいろなタイプのデータソース（変数）にバインドできるユニークなフォームオブジェクトです。具体的には，プロパティとデータソースの組み合わせにより，下記４タイプの設定ができます。

  * ARRAY TEXT（デフォルト値）  
  * ARRAY TEXT（配列）   
  * C_LONGINT（リスト項目の参照番号）  
  * C_TEXT（リスト項目の値）  

大概のフォームオブジェクトは，バインドできるデータソース（変数）のタイプが決まっているので，変数タイプのプロパティがどうであれ，コンパイラーは正しい型を特定することができます。しかし，テキスト入力（フィールドまたは変数）・リストボックス・ポップアップメニュー・コンボボックスについては，複数の変数タイプにバインドすることができるため，静的な変数をバインドするのであれば，[コンパイラーメソッド](https://doc.4d.com/4Dv16/4D/16.4/Compiler-page.300-3998744.ja.html#460189)でその型を指定する必要があることに留意してください。

### プロパティリストの「変数タイプ」について

フォームイベントを発生させるフォームオブジェクト（アクティブオブジェクト）のプロパティリストには「変数タイプ」という項目が表示されます。このプロパティは，[ダイナミック変数](https://doc.4d.com/4Dv17/4D/17/Variables.300-3730594.ja.html#202551)（静的な変数名がなく，スコープがフォームに対してローカルな変数）の型指定に使用されます。一方，プロセス変数などの静的な変数の型を指定する働きはありません。

変数に名前が与えられている場合，「変数タイプ」は**実際には変数の型を指定しません。プロパティリストのオプション表示を更新するだけです** (ピクチャー変数を除く)。名前付き変数の型を指定するには，コンパイラテーマのコマンドを使用しなければなりません。— [ランゲージリファレンス > プログラミング言語の構成要素 > 変数](https://doc.4d.com/4Dv17/4D/17/Variables.300-3730594.ja.html)

プロセス変数やインタープロセス変数などの静的な変数をフォームオブジェクトにバインドするスタイルは，**互換性のために残されている古典的なコーディング**に属するものです。現在でも，試作品（プロトタイプ）のようなコンセプト実証を手速く制作する場合には，このスタイルが有効ですが，**本格的な開発には，[ダイナミック変数](https://doc.4d.com/4Dv17/4D/17/Variables.300-3730594.ja.html#202551)や[``Form``](https://doc.4d.com/4Dv17/4D/17/Form.301-3730839.ja.html)オブジェクトのプロパティを使用する**ことが推奨されています。

コンパイラーメソッドは，[コンパイラー](https://doc.4d.com/4Dv16/4D/16.4/Compiler-window.300-3998789.ja.html)に自動生成させることもできます。「型宣言せお生成」ボタンをクリックすると，コンパイラーはすべてのメソッドを解析し，代入文・引数・[コンパイラコマンド](https://doc.4d.com/4Dv17/4D/17/Compiler-Commands.300-3730852.ja.html)などに基づき，変数の型を推定しようとします。コンパイラーメソッドで型が宣言されている静的な変数は，メソッドエディター上でマウスポインターを重ねるとタイプ名が表示され，タイプアヘッドの候補リストに表示されます。

### デフォルト値

もっとも手軽なのは，ポップアップメニューのプロパティリストに[デフォルト値](https://doc.4d.com/4Dv17/4D/17/Data-entry-controls-and-assistance.300-3743635.ja.html#421922)を書き込む，という方法です。デフォルト値は，フォームがロードされると，オブジェクトのデータソース（変数）にテキスト配列としてコピーされます。したがって，変数は``ARRAY TEXT``で宣言されていることが暗黙的に求められています。

配列の値はデフォルト値ですでに定義されているため，コードには``If (myMenuArray=1)``あるいは``myMenuArray:=1``のような比較演算あるいは代入文しか記述されていないかもしれません，その場合，コンパイラーは，``myMenuArray``が数値型である，という誤った指定をすることになります。数値型は，ポップアップメニューのデータソースとして有効なタイプだからです。一方，``ARRAY TEXT(myMenuArray;3)``のように配列のサイズを指定した場合，ポップアップメニューの項目数がデフォルト値の行数と食い違ってしまうかもしれません。

ポップアップメニューのデータソースにデフォルト値を使用する場合，コンパイラーに対して「ヒント」を与えるような形で，下記のように実行されないコードを記述することが勧められています。

```
If (False)
 ARRAY TEXT(myMenuArray;0)
End if
```

### 配列

既定の配列を「デフォルト値」に書き込む代わりに，コードで構築した``ARRAY TEXT``をポップアップメニューにバインドすることもできます。配列の名前は，プロパティリストに書き込むこともできますし，[``OBJECT SET DATA SOURCE``](https://doc.4d.com/4Dv17/4D/17/OBJECT-SET-DATA-SOURCE.301-3730455.ja.html)でバインドすることもできます。

変数名を「無名」とした場合，つまり，ダイナミック変数を使用する場合，リストが関連づけられていないポップアップメニューのデータソースはテキスト配列となります。ポップアップメニューはコレクション型をサポートしていないため，``Form``オブジェクトのプロパティをこのスタイルでバインドすることはできません。後述するリスト項目を使用する必要があります。

### リスト項目の参照番号

配列の代わりにリストをポップアップメニューにバインドすることができます。リストは，ツールボックスに登録されたものをプロパティリストの「選択リスト」に入力することもできますし，[``OBJECT SET LIST BY REFERENCE``](https://doc.4d.com/4Dv17/4D/17/OBJECT-SET-LIST-BY-REFERENCE.301-3730508.ja.html)あるいは[``OBJECT SET LIST BY NAME``](https://doc.4d.com/4Dv17/4D/17/OBJECT-SET-LIST-BY-NAME.301-3730497.ja.html)でバインドすることもできます。後者は，プロパティリストでリスト名を指定するのとあまり変わりませんが，前者は[``New list``](https://doc.4d.com/4Dv17/4D/17/New-list.301-3730805.ja.html)で構築したリストを扱うことができ，より柔軟かつ強力です。

リストは，ツールボックスに登録されたもの，あるいはコードで構築されたもの，どちらであっても，重複しない一意の参照番号が割り振られていることが前提となっています。とはいえ，4Dのランタイムは参照番号の一意性をチェックすることはしないので，有効な参照番号を各項目にきちんと設定することは，デベロッパーの責任となっています。リスト項目の参照番号でポップアップメニューを管理するスタイルは，項目の表示テキストに関係なく，参照番号を絶対的な値として用いる場面において有効です。たとえば，表示テキストの言語を切り替えられるようなアプリケーションで使用されることが想定されています。参照番号は数値型です。したがって，変数は``C_LONGINT``で宣言されていることが暗黙的に求められています。配列ではないので，``Form``オブジェクトのプロパティをバインドすることもできます。


### リスト項目の値

参照番号の代わりに，リスト項目の値そのものをポップアップメニューにバインドすることもできます。配列やリスト項目の参照番号のように，選択された位置や番号から項目を参照する必要がなく，選択された項目がそのまま変数にセットされるので，慣れてしまえば，もっとも自然で簡単な方法です。リストの値はテキスト型です。したがって，変数は``C_TEXT``で宣言されていることが暗黙的に求められています。配列ではないので，``Form``オブジェクトのプロパティをバインドすることもできます。

**注記**: ポップアップメニューのデータソースは，[``OBJECT SET DATA SOURCE``](https://doc.4d.com/4Dv17/4D/17/OBJECT-SET-DATA-SOURCE.301-3730455.ja.html) [``OBJECT SET LIST BY REFERENCE``](https://doc.4d.com/4Dv17/4D/17/OBJECT-SET-LIST-BY-REFERENCE.301-3730508.ja.html) [``OBJECT SET LIST BY NAME``](https://doc.4d.com/4Dv17/4D/17/OBJECT-SET-LIST-BY-NAME.301-3730497.ja.html)で自由に切り替えることができます。しかし，「関連付け」の「リスト項目の参照番号・リスト項目の値」は，プロパティリストで決定する必要があり，フォーム実行中に変更することはできません。また，これらのプロパティは，「選択リスト」が設定されていないとアクセスできないため，配列ではなく，リストをデータソースに使用するのであれば，たとえツールボックスのリストではなく，``New list``を使用するつもりであっても，プロパティリストの上ではツールボックスのリストをどれか指定する必要があります。とはいえ，デフォルトは「リスト項目の値（つまりテキスト）」なので，「リスト項目の参照番号（つまり数値）」を使用するのでなければ，「なし」のままでも問題ないでしょう。
