---
layout: technote
original_title: Kiosk Mode on Windows10
title: "Windows 10 キオスクモード"
author: Guillaume Kotulski
position: Developer, 4D SAS
date: 2018-03-27 00:00:00
categories: セットアップ
tags: deployment windows10 
version: 17
---

Windows10マシンをキオスクモードにして、4Dアプリケーションを動かす方法の紹介です。([原文](https://kb.4d.com/assetid=77976)）
<!--more-->

## はじめに
---
このテクニカルノートではどのようにWindows 10マシンをキオスクモードにして、4Dアプリケーションを動かすかについて説明しています。

## 導入
---
キオスクモードとは、あるWindows デバイスが特定のタスクに使用されているとき、または公の環境で使用されている時にそのデバイスを"ロック"してしまうための一般的な方法です。例えば、レジのようなPOSアプリケーションにおいて、ユーザーがアプリケーションから出て他のアプリを閲覧したりするのを防ぎ、その結果コンピューターを意図した用途以外で使用したり、重要なツールが閉じられたりすることを防いでデバイスの安全性を確保します。

## Windows10のキオスクモード 
---
### 必須条件 

キオスクモードのアプリケーションを作成するためには、以下の条件が必要になります。
- Windows構成デザイナー - これはWindowsエンタープライズ、またはエデュケーション(バージョン1709またはそれ以上)でしか利用できません。
- ターゲットとなるマシンにはWindowsエンタープライズまたはエデュケーション(バージョン1709またはそれ以上)があらかじめインストールされている必要があります。
- 4Dアプリケーション(組み込みアプリケーション)はSDIモードで作成されている必要があり、さらに言うとタイトルバーがないことが望ましいです(閉じるボタンが表示されなくなるため)。

ターゲットとなるマシンがキオスクモードになっているとき、その設定の変更は全面的に不可能です。そのためパッケージを適用する前に復元ポイントを設けておいてください。または、キオスクモードの影響を受けない管理者アカンウトを追加しておいてください。またパッケージは開発用のPCではなく、ターゲットマシンで使用するようにしてください。
下記はentitySelectionを検索するクエリで、患者の中で名前がRyanもしくはKevinで、現在クラリンチンという薬を摂取していて、症候的な熱がある人を検索します。

### 環境を設定する
環境の設定をすることで、Windowsの一部の機能を以下のように非表示、あるいは無効化することができます:

- ユーザーインターフェースを出さない
- キーボードのフィルター(Windowsキー、Ctrl+Alt+Escなどのイベントを無効化)
- アプリケーションを閉じた場合にそれを自動的に再起動する

環境を設定されるユーザーは、PowerShellスクリプトか、またはWindows構成デザイナーというWindowsアプリケーションを使用することで設定可能です。これらのメソッドはシェルローンチャーを有効化し、結果Windowsの起動時に任意のアプリケーションを開くことができます。一般的にはシェルローンチャーは"explorer.exe"(ユーザーインターフェース)を開始します。

### Windows構成デザイナー
Windows構成デザイナーとはWindows 10システムの構成を設定するためのWindows用アプリケーションです(初めからインストールされています)。このアプリケーションは、Windows 10デバイスを、起動時に4Dアプリケーションを開くように設定されたキオスクモードになるためのパッケージを作成します。

 １. "キオスクデバイスのプロビジョニング"オプションを選択し、アプリケーションのキオスクを作成し、その後の指示にしたがってください。

![図１：設定画面](/images/kiosk/kiosk-mode-1.png){: .align-center}

 ２. プロジェクト名とパスを入力してください。

![図２：プロジェクト詳細入力画面](/images/kiosk/kiosk-mode-2.png){: .align-center}

 ３. デバイス名を設定してください。

![図３：デバイス設定画面](/images/kiosk/kiosk-mode-3.png){: .align-center}

 ４. ネットワークを設定してください。

![図４：ネットワーク設定画面](/images/kiosk/kiosk-mode-4.png){: .align-center}

 ５. アカウント管理から、ローカルの管理アカウント作成するよう設定してください(このアカウントはキオスクモードの影響を受けません)。

![図５：アカウント管理画面](/images/kiosk/kiosk-mode-5.png){: .align-center}

 ６. 必要なアプリケーションを追加してください。追加したアプリケーションはパッケージ実行時にインストールされます。

![図６：追加アプリケーション設定画面](/images/kiosk/kiosk-mode-6.png){: .align-center}

 ７. 認証を追加してください(ただしこのテックノートの目的のためには必要ありません)。

![図７：認証追加画面](/images/kiosk/kiosk-mode-7.png){: .align-center}

 ８. キオスクアカウントとアプリケーションを設定します。
 - ユーザー名はキオスクの名前と同じである必要があります。
 - アプリケーションの種類は"Classic Windows App"を選択して下さい。
 - アプリケーションがインストールされるフルパスを選択して下さい。

![図８：キオスクユーザーアカウント設定画面](/images/kiosk/kiosk-mode-8.png){: .align-center}

９. キオスク共通設定を設定します。

![図９：共通設定画面](/images/kiosk/kiosk-mode-9.png){: .align-center}

パッケージを書き出す前に、ページ下部の"Switch to advanced editor"をクリックすることでより詳細なカスタマイズを追加することができます。

### 上級者向けエディター
上級者向けエディターを使用すると、それぞれのユーザーに対して、アプリケーションが閉じられた際のデフォルトアクションなどを異なる設定にしたシェルローンチャーを構成することができます。修復を実行すると、ログファイルが生成されます。エラーが修正されていることを確認するために、検証を再実行することも重要です。ある損傷箇所が別の問題を隠してしまう場合があるため、検出も修復もできなかったエラーが新たに検出される可能性があります。このような状況では、エラーがすべて修正されるまでプロセスを繰り返す必要があります。

キオスクモードに必要なオプションは主にSMISettingsの箇所にまとまっています。

　１. 全員に対してのデフォルトのユーザーインターフェースを設定します。

![図１０：SMISettings/ShellLauncher設定画面](/images/kiosk/kiosk-mode-10.png){: .align-center}

　２. アプリケーションが閉じられた際に自動的に開かれるキオスクアプリケーションを設定します。

![図１１：SMISettings/…/Kiosk4D画面](/images/kiosk/kiosk-mode-11.png){: .align-center}

注: より制約の厳しいキオスクを設定するためには、"Autologon"と"NoLockScreen"を有効化し、"Shit+Ctrl+Esc"、"Application"、"WinHome"などのイベントをブロックして下さい。

### 書き出しとインストール
構成が完了したら、Export > Provisioning > package と選択してパッケージを書き出します。その後、指示に従ってパッケージをビルドして下さい。

Step1:
![図１２：プロビジョニングパッケージ詳細設定画面](/images/kiosk/kiosk-mode-12.png){: .align-center}

Step2:
![図１３：パッケージのセキュリティ設定画面](/images/kiosk/kiosk-mode-13.png){: .align-center}

Step3:
![図１４：プロビジョニングパッケージ保存先選択画面](/images/kiosk/kiosk-mode-14.png){: .align-center}

Step4:
![図１５：パッケージビルド最終画面](/images/kiosk/kiosk-mode-15.png){: .align-center}

ターゲットマシンをキオスクモードに設定するためには、そのマシン上でパッケージを実行し、そのままシステムが再起動するのをお待ちください。

### キオスクモードの終了と復元
キオスクモードが有効化されているアカウントを終了して管理アカウントにログインするためには、以下のようないくつかの方法があります:
- "Windows+L"のショートカットを使用してロック画面に移動する。
- PCを再起動する(自動ログオンが有効化されていない場合に限る)。
- インターフェースで以下の方法を実行する。

　１. "Ctrl+Maj+Esc"または"Ctrl+Alt+Del"からタスクマネージャーを起動する
　２. 画面下部の「詳細」をクリックする
　３. ファイル > 新しいタスクの実行 から、"explorer.exe"と記入してOKを押す
　４. 他のアカウントにログインする。

- コマンドラインを使用する。インターフェースと同様の手順を踏みますが、"explorer.exe"の代わりに"tsdiscon"と記入してOKを押します。

管理アカウントに入ったあと、復元ポイントを使用してシステムを復元して下さい。復元ポイントが失敗した場合、以前のパッケージを(Windows構成デザイナーを使用して)変更し、行った変更を取り消します。その後キオスクモードで作成したアカウントを削除して下さい。

## 終わりに
---
このテクニカルノートでは4DのプログラムをWindowsのキオスクモードで実行することと、その実装について説明しました。構成にはWindows構成デザイナーを使用したましたが、同じことはPower Shell スクリプトを使用してもできます。
