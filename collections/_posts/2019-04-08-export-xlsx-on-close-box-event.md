---
layout: post
title: "On Close BoxイベントでExcel形式のエクスポート"
date: 2019-04-08 09:43:00
categories: 仕様
tags: 17r3 viewpro
version: 17r3
---

17r3以降，スプレッドシートを[``VP EXPORT DOCUMENT``](https://doc.4d.com/4Dv17R3/4D/17-R3/VP-EXPORT-DOCUMENT.301-3935956.ja.html)で``.xlsx``形式でエクスポートすることができるようになりました。``.4vp``形式を指定した場合，コマンドは同期処理でファイルを書き出しますが，``.xlsx``形式を指定した場合，非同期処理でファイルを書き出した後，コールバックとして渡された``Formula``オブジェクトが実行されるようになっています。``On Close Box``フォームイベントでコマンドを実行した場合，ウィンドウが閉じられることにより，非同期処理がアボートされてしまうため，``.xlsx``形式のエクスポートはキャンセルされてしまいます。これは仕様です。ダイアログの終了と同時にエクスポートを実行するのであれば，コールバックとして渡された``Formula``オブジェクトが実行された後にウィンドウを閉じるようにしてください。
