---
layout: technote
title: "4D World Tour 2019（１日目）"
author: Keisuke Miyako
date: 2019-05-28 00:00:00
permalink: /event/2019-05-28/
standalone: true
---

## ビジネスアプリケーションの革新的な基盤
---

v17は，革新的なプラットフォームです。v2004やv11も印象的なバージョンでしたが，v17は，アプリケーションがすべての点で飛躍的な進歩を遂げています。

- プログラミング言語（ORDA）
- ユーザーエクスペリエンス（SDI リストボックス ダイナミックフォーム）
- パフォーマンス（キャッシュマネージャー プリエンプティブモード）
- セキュリティ
- 統合ソリューション（4D Write Pro・4D View Pro・4D for iOS）

### Ｒリリース

v14以降，アジャイル開発の手法が採用され，品質管理の体制が強化されています。

- 目標を数週間の小さな仕事（プロジェクト）に分割する
- 責任者・デベロッパー・ドキュメントライター・テスターがチームで開発する
- プロジェクト毎に計画から検証までの開発サイクルを繰り返す
- 定期的にソフトウェアをリリースする
- 期日内にサイクルを完了しなかったプロジェクトはリリースから除外する

アジャイル開発は，ビジネスアプリケーションという分野に特有の課題，つまり「先進性と互換性の両立」を達成する上で役立っています。

- リリース前製品の開発とリリース後製品の保守が明確に仕切られている
- リリース前製品の開発プロジェクトはベータテストで重点的に検証する
- 最新版がもっとも安定性している（経験則に基づく従来の認識は通用しない）

## キャッシュマネージャーの管理
---

v11以降のキャッシュマネージャーは，基本的に32ビット版アプリケーションを想定したデザインでした。

- キャッシュサイズは固定
- 無差別にパージ
- キャッシュサイズの25%単位でパージ
- ``4``から``12``GB程度のサイズを想定
- フラグメンテーションの恐れあり

v16以降の64ビット版は，ハードウェアのポテンシャルを引き出す新しいキャッシュマネージャーを使用しています。

- キャッシュサイズは可変 （[``SET CACHE SIZE``](https://doc.4d.com/4Dv17/4D/17.1/SET-CACHE-SIZE.301-4179631.ja.html)）
- オブジェクトの[優先度](https://doc.4d.com/4Dv17/4D/17.1/Managing-priorities-in-database-cache.300-4179634.ja.html)に応じてパージ
- バイト単位でパージ （[``FLUSH CACHE``](https://doc.4d.com/4Dv17/4D/17.1/FLUSH-CACHE.301-4179629.ja.html)）
- ``100``MBから``100``GB以上まで幅広いサイズを想定
- フラグメンテーションの恐れなし

## ハードウェアの力を使用する
---

プリエンプティブプロセスは，複数のCPUコアに分散して処理を実行することができます。コオペラティブプロセスは，単一のCPUコアで順番に処理を実行することしかできません。プリエンプティブモードを活用すれば，アプリケーションのスケーラビリティ（拡張性）を高めることができます。対応を怠ると，せっかくのハードウェアスペックが宝の持ち腐れになるかもしれません。

対応コマンドは，ドキュメントまたは[``Command name``](https://doc.4d.com/4Dv17/4D/17.1/Command-name.301-4178626.ja.html)で確認することができます。プリエンプティブプロセスは，Unicodeモードが有効にされた64ビット版のコンパイルモードで使用することができます。初期メソッド（新規プロセスまたはワーカーを開始するメソッド）の「プリエンプティブモードで実行可」プロパティが有効にされていれば，コンパイラーが呼び出しチェーンのコマンド/メソッドをチェックします。

## Webサーバーにもっとパワーを
---

Webプロセスの場合，メソッド毎の設定はありません。データベース設定でプリエンプティブモードを有効にすることができます。Webサービスの場合，メソッドのプロパティ「プリエンプティブモードで実行可」を有効にすれば，コンパイラーが呼び出しチェーンのコマンド/メソッドをチェックします。

## プロセス間のデータ交換

プリエンプティブモードでは，インタープロセス変数や[``GET PROCESS VARIABLE``](https://doc.4d.com/4Dv17/4D/17.1/GET-PROCESS-VARIABLE.301-4179335.ja.html)といったテクニックは使用できません。しかし，共有オブジェクト・ストレージ・シグナルを使用すれば，プロセス間のデータ交換ができます。

## 4D Remote のプリエンプティブ
---

新ネットワークレイヤーが有効にされていれば，クライアント側でプリエンプティブプロセスを起動し，ユーザーインタフェースをブロックせずに高度な集計をバックグラウンドプロセスで実行することができます。

### ローカルプロセスのサーバーアクセス

ローカルプロセスまたはローカルワーカーからデータベースにアクセスした場合，あるいは[``Current time (*)``](https://doc.4d.com/4Dv17/4D/17.1/Current-time.301-4179461.ja.html)など，サーバー側との通信が必要なコマンドを実行した場合，そのプロセスを起動したコマンドによってアクセスの方法が違います。

- [``CALL WORKER``](https://doc.4d.com/4Dv17/4D/17.1/CALL-WORKER.301-4179333.ja.html): サーバー側に作成されるツインプロセスと通信
- [``New process``](https://doc.4d.com/4Dv17/4D/17.1/New-process.301-4179077.ja.html)アプリケーションプロセスと通信

### Begin SQL/End SQL

カレントセレクションを変更しないクエリは，ORDAで記述することができます。今後，SQL言語を拡張する予定はありません。しかし，既存をコードをサポートするため，[``Begin SQL``](https://doc.4d.com/4Dv17/4D/17.1/Begin-SQL.301-4179382.ja.html) [``End SQL``](https://doc.4d.com/4Dv17/4D/17.1/End-SQL.301-4179383.ja.html)ブロックがプリエンプティブモード対応になりました。

具体的には，SQLで使用されている変数・テーブル・メソッド名をコンパイラーが抽出してチェックします。インタープロセス・トリガ・呼び出し連鎖のチェックにパスすれば，そのメソッドはスレッドセーフです。ローカルスキーマに存在しないテーブルのトリガはチェックされません（トリガをSQLで作成することはできないため）。

[``EXECUTE IMMEDIATE``](https://doc.4d.com/4Dv17/4D/17/EXECUTE-IMMEDIATE.300-3786781.ja.html)の変数/メソッドは，SQL実行前にもう一度ランタイムがチェックします。

#### 用途

- ローカルデータベース
- C/Sアプリケーション
- エクスターナルデータベース（``USE DATABASE``）

#### 非サポート

- ``ODBC``
- ``INTO LISTBOX``
- ``QUERY BY SQL``
- ``REPLICATE`` ``SYNCHRONIZE``
- ``SQL LOGIN``
